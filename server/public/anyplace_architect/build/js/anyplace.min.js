function CanvasOverlay(a,b){for(this.top=0,this.left=0,this.width=a.width,this.height=a.height;window&&(this.width>window.innerWidth||this.height>window.innerHeight);)this.width/=2,this.height/=2;this.image_=a,this.map_=b,this.div_=null,this.canvas=null,this.ctx=null,this.angle=0,this.scale=1,this.latlng=b.getCenter(),this.new_left=0,this.new_top=0,this.setMap(b)}function deg2rad(a){return a*Math.PI/180}function rad2deg(a){return a/Math.PI*180}function getRotationDegrees(a){var b=a.css("-webkit-transform")||a.css("-moz-transform")||a.css("-ms-transform")||a.css("-o-transform")||a.css("transform");if("none"!==b)var c=b.split("(")[1].split(")")[0].split(","),d=c[0],e=c[1],f=(c[2],c[3],Math.sqrt(d*d+e*e),Math.round(Math.atan2(e,d)*(180/Math.PI)));else var f=0;return f}function hexToBase64(a){return btoa(String.fromCharCode.apply(null,a.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")))}function base64_encode(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do{b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h)}while(k<a.length);m=n.join("");var o=a.length%3;return(o?m.slice(0,o-3):m)+"===".slice(o||3)}function USGSOverlay(a,b,c){this.bounds_=a,this.image_=b,this.image64=b,this.map_=c,this.div_=null,this.setMap(c)}var app=angular.module("anyArchitect",["ngCookies","angularjs-dropdown-multiselect","ui.bootstrap","ui.select","ngSanitize"]);app.service("GMapService",function(){this.gmap={};var a=this,b={center:{lat:35.14448545801575,lng:33.41121554374695},zoom:8,panControl:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},mapTypeControl:!0,mapTypeControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!0,streetViewControl:!1,overviewMapControl:!0};a.gmap=new google.maps.Map(document.getElementById("map-canvas"),b);var c=document.getElementById("pac-input");a.gmap.controls[google.maps.ControlPosition.TOP_LEFT].push(c),a.searchBox=new google.maps.places.SearchBox(c),google.maps.event.addListener(a.searchBox,"places_changed",function(){var b=a.searchBox.getPlaces();0!=b.length&&(a.gmap.panTo(b[0].geometry.location),a.gmap.setZoom(17))}),a.gmap.addListener(a.gmap,"bounds_changed",function(){var b=a.gmap.getBounds();a.searchBox.setBounds(b)})}),app.factory("AnyplaceService",function(){var a={};return a.selectedBuilding=void 0,a.selectedFloor=void 0,a.selectedPoi=void 0,a.selectedCampus=void 0,a.ShowShareProp=void 0,a.progress=void 0,a.allPois={},a.allConnections={},a.radioHeatmapRSSMode=!1,a.fingerPrintsTimeMode=!1,a.radioHeatmapRSSTimeMode=!1,a.alerts=[],a.jsonReq={username:"username",password:"password"},a.BASE_URL="https://ap.cs.ucy.ac.cy",a.getBuilding=function(){return this.selectedBuilding},a.getCampus=function(){return this.selectedCampus},a.getBuildingId=function(){if(this.selectedBuilding)return this.selectedBuilding.buid},a.getBuildingName=function(){return this.selectedBuilding?this.selectedBuilding.name:"N/A"},a.getCampusName=function(){return this.selectedCampus?this.selectedCampus.name:"N/A"},a.getFloor=function(){return this.selectedFloor},a.getFloorNumber=function(){return this.selectedFloor?String(this.selectedFloor.floor_number):"N/A"},a.getFloorName=function(){return this.selectedFloor.floor_name},a.setBuilding=function(a){this.selectedBuilding=a},a.setFloor=function(a){this.selectedFloor=a},a.addAlert=function(a,b){this.alerts[0]={msg:b,type:a}},a.closeAlert=function(a){this.alerts.splice(a,1)},a.getBuildingViewerUrl=function(){return this.selectedBuilding&&this.selectedBuilding.buid?this.selectedBuilding.buid:"N/A"},a.getBuildingViewerUrlEncoded=function(){return this.selectedBuilding&&this.selectedBuilding.buid?encodeURIComponent("https://ap.cs.ucy.ac.cy/viewer/?buid="+this.selectedBuilding.buid):"N/A"},a.getCampusViewerUrl=function(){return this.selectedCampus&&this.selectedCampus.cuid?"https://ap.cs.ucy.ac.cy/viewer/?cuid="+this.selectedCampus.cuid:"N/A"},a.getCampusViewerUrlEncoded=function(){return this.selectedCampus&&this.selectedCampus.cuid?encodeURIComponent("https://ap.cs.ucy.ac.cy/viewer/?cuid="+this.selectedCampus.cuid):"N/A"},a.setAllPois=function(a){this.allPois={},this.allPois=a},a.setAllConnection=function(a){this.allConnections={},this.allConnections=a},a.getAllPois=function(){return this.allPois?this.allPois:"N/A"},a.getAllConnections=function(){return this.allConnections?this.allConnections:"N/A"},a.clearAllData=function(){a.selectedPoi=void 0,a.selectedFloor=void 0,a.selectedBuilding=void 0,a.selectedCampus=void 0,a.ShowShareProp=void 0,a.allPois={},a.allConnections={}},a}),app.factory("Alerter",function(){var a={};return a.AlertCtrl="-",a}),app.factory("formDataObject",function(){return function(a,b){var c=new FormData;return angular.forEach(a,function(a,b){c.append(b,a)}),delete b()["Content-Type"],c}}),app.config(["$locationProvider",function(a){a.html5Mode(!0)}]),app.filter("propsFilter",function(){return function(a,b){var c=[];return angular.isArray(a)?a.forEach(function(a){for(var d=!1,e=Object.keys(b),f=0;f<e.length;f++){var g=e[f],h=b[g].toLowerCase();if(-1!==a[g].toString().toLowerCase().indexOf(h)){d=!0;break}}d&&c.push(a)}):c=a,c}}),app.factory("myInterceptor",[function(){return{request:function(a){return void 0!==a.url&&0!==a.url.indexOf(AnyplaceAPI.FULL_SERVER)?a:(a.data&&(a.data.access_token=app.access_token),a)}}}]),app.config(["$httpProvider",function(a){a.interceptors.push("myInterceptor")}]);var AnyplaceAPI={};AnyplaceAPI.FULL_SERVER="https://polkowski.duckdns.org/anyplace",AnyplaceAPI.Mapping={},AnyplaceAPI.Mapping.RADIO_HEATMAP="/mapping/radio/heatmap_building_floor",AnyplaceAPI.Mapping.RADIO_HEATMAP_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS="/mapping/radio/heatmap_building_floor_avarage",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_1="/position/radio/heatmap_building_floor_average_1",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_1=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_1,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_2="/position/radio/heatmap_building_floor_average_2",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_2=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_2,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_3="/position/radio/heatmap_building_floor_average_3",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_3=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_3,AnyplaceAPI.Mapping.APs="/position/radio/APs_building_floor",AnyplaceAPI.Mapping.APs_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.APs,AnyplaceAPI.Mapping.FINGERPRINTS_DELETE="/position/radio/delete",AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FINGERPRINTS_DELETE,AnyplaceAPI.Mapping.GET_APS_IDS="/position/radio/aps_ids",AnyplaceAPI.Mapping.GET_APS_IDS_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.GET_APS_IDS,AnyplaceAPI.Mapping.FINGERPRINTS_TIME="/position/radio/time",AnyplaceAPI.Mapping.FINGERPRINTS_TIME_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FINGERPRINTS_TIME,AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME="/position/radio/heatmap_building_floor_timestamp",AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_1="/position/radio/heatmap_building_floor_timestamp_average_1",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_1=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_1,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_2="/position/radio/heatmap_building_floor_timestamp_average_2",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_2=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_2,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_3="/position/radio/heatmap_building_floor_timestamp_average_3",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_3=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_3,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES="/position/radio/acces",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES,AnyplaceAPI.Mapping.RADIO_HEATMAP_POI="/mapping/radio/radio_heatmap_bbox",AnyplaceAPI.Mapping.RADIO_HEATMAP_URL_POI=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_POI,AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL="/position/radio_by_building_floor_all",AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL,AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT="/position/radio_by_building_floor_all_text",AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT,AnyplaceAPI.Mapping.BUILDING_ADD="/mapping/building/add",AnyplaceAPI.Mapping.BUILDING_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDING_ADD,AnyplaceAPI.Mapping.CAMPUS_ALL="/mapping/campus/all_owner",AnyplaceAPI.Mapping.CAMPUS_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CAMPUS_ALL,AnyplaceAPI.Mapping.CAMPUS_UPDATE="/mapping/campus/update",AnyplaceAPI.Mapping.CAMPUS_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CAMPUS_UPDATE,AnyplaceAPI.Mapping.CAMPUS_DELETE="/mapping/campus/delete",AnyplaceAPI.Mapping.CAMPUS_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CAMPUS_DELETE,AnyplaceAPI.Mapping.BUILDINGSET_ADD="/mapping/campus/add",AnyplaceAPI.Mapping.BUILDINGSET_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDINGSET_ADD,AnyplaceAPI.Mapping.POISCATEGORY_ADD="/mapping/pois/add_category",AnyplaceAPI.Mapping.POISCATEGORY_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POISCATEGORY_ADD,AnyplaceAPI.Mapping.BUILDING_UPDATE="/mapping/building/update",AnyplaceAPI.Mapping.BUILDING_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDING_UPDATE,AnyplaceAPI.Mapping.BUILDING_DELETE="/mapping/building/delete",AnyplaceAPI.Mapping.BUILDING_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDING_DELETE,AnyplaceAPI.Mapping.BUILDING_ALL="/mapping/building/all_owner",AnyplaceAPI.Mapping.BUILDING_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDING_ALL,AnyplaceAPI.Mapping.FLOOR_ADD="/mapping/floor/add",AnyplaceAPI.Mapping.FLOOR_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_ADD,AnyplaceAPI.Mapping.FLOOR_UPDATE="/mapping/floor/update",AnyplaceAPI.Mapping.FLOOR_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_UPDATE,AnyplaceAPI.Mapping.FLOOR_DELETE="/mapping/floor/delete",AnyplaceAPI.Mapping.FLOOR_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_DELETE,AnyplaceAPI.Mapping.FLOOR_ALL="/mapping/floor/all",AnyplaceAPI.Mapping.FLOOR_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_ALL,AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD="/mapping/floor/upload",AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD,AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD="/floorplans64/",AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD,AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_ALL="/floorplans64all/",AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL_ALL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_ALL,AnyplaceAPI.Mapping.POIS_ADD="/mapping/pois/add",AnyplaceAPI.Mapping.POIS_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_ADD,AnyplaceAPI.Mapping.POIS_UPDATE="/mapping/pois/update",AnyplaceAPI.Mapping.POIS_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_UPDATE,AnyplaceAPI.Mapping.POIS_DELETE="/mapping/pois/delete",AnyplaceAPI.Mapping.POIS_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_DELETE,AnyplaceAPI.Mapping.POIS_ALL_FLOOR="/mapping/pois/all_floor",AnyplaceAPI.Mapping.POIS_ALL_FLOOR_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_ALL_FLOOR,AnyplaceAPI.Mapping.POIS_ALL_BUILDING="/mapping/pois/all_building",AnyplaceAPI.Mapping.POIS_ALL_BUILDING_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_ALL_BUILDING,AnyplaceAPI.Mapping.POIS_TYPES="/mapping/pois/types",AnyplaceAPI.Mapping.POIS_TYPES_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_TYPES,AnyplaceAPI.Mapping.CONNECTION_ADD="/mapping/connection/add",AnyplaceAPI.Mapping.CONNECTION_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_ADD,AnyplaceAPI.Mapping.CONNECTION_UPDATE="/mapping/connection/update",AnyplaceAPI.Mapping.CONNECTION_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_UPDATE,AnyplaceAPI.Mapping.CONNECTION_DELETE="/mapping/connection/delete",AnyplaceAPI.Mapping.CONNECTION_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_DELETE,AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR="/mapping/connection/all_floor",AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR,AnyplaceAPI.Mapping.SIGN="/mapping/accounts/sign",AnyplaceAPI.Mapping.SIGN_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.SIGN,app.factory("AnyplaceAPIService",["$http","$q","formDataObject",function(a,b,c){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"];var d={};return d.getRadioHeatmap=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSS=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSS_1=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_1,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSS_2=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_2,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSS_3=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_3,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSSByTime_1=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_1,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSSByTime_2=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_2,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSSByTime_3=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_3,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapRSSByTime=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getAPs=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.APs_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getAPsIds=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.GET_APS_IDS_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteFingerprints=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getFingerprintsTime=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.FINGERPRINTS_TIME_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getHeatmapAcces=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.retrievePoisTypes=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.POIS_TYPES_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.retrievePoisByBuilding=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.POIS_ALL_BUILDING_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioHeatmapPoi=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_URL_POI,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioByBuildingFloorAll=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.getRadioByBuildingFloorTxt=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addBuilding=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addBuildingSet=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.BUILDINGSET_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addCategory=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.POISCATEGORY_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.updateBuilding=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_UPDATE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.updateCampus=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.CAMPUS_UPDATE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteBuilding=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteCampus=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.CAMPUS_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.allBuildings=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_ALL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.allCampus=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.CAMPUS_ALL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addFloor=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.updateFloor=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_UPDATE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteFloor=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.allBuildingFloors=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_ALL_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.uploadFloorPlan=function(b,d){return a({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD_URL,headers:{"Content-Type":"multipart/form-data"},data:{floorplan:d,json:b},transformRequest:c}).success(function(a,b){return a}).error(function(a,b){return a})},d.uploadFloorPlan64=function(b,c){var d=c.replace("data:image/png;base64,",""),e=LPUtils.Base64Binary.decode(d),f=new Blob([e]);d="";for(var g=0;g<e.length;g++)d+=e[g];var h=new FormData;return h.append("json",b),h.append("floorplan",f),a.post(AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD_URL,h,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(a,b){return a}).error(function(a,b){return a})},d.downloadFloorPlan=function(b,c,d){return a({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL+c+"/"+d,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.downloadFloorPlanAll=function(b,c,d){return a({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL_ALL+c+"/"+d,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addPois=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.POIS_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.updatePois=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.POIS_UPDATE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deletePois=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.POIS_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.retrievePoisByBuildingFloor=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.POIS_ALL_FLOOR_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.addConnection=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_ADD_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.updateConnection=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_UPDATE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.deleteConnection=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_DELETE_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.retrieveConnectionsByBuildingFloor=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d.signAccount=function(b){return a({method:"POST",url:AnyplaceAPI.Mapping.SIGN_URL,data:b}).success(function(a,b){return a}).error(function(a,b){return a})},d}]),CanvasOverlay.prototype=new google.maps.OverlayView,CanvasOverlay.prototype.onAdd=function(){function a(a){return parseInt(a,10)||0}function b(a){var b=window.getComputedStyle(a,null),c=b.getPropertyValue("-webkit-transform")||b.getPropertyValue("-moz-transform")||b.getPropertyValue("-ms-transform")||b.getPropertyValue("-o-transform")||b.getPropertyValue("transform")||null;if(c&&"none"!=c){var d=c.split("(")[1];d=d.split(")")[0],d=d.split(",");for(var e=d[0],f=d[1],g=Math.round(Math.atan2(f,e)*(180/Math.PI));g>=360;)g=360-g;for(;g<0;)g=360+g;return g}return 0}function c(a){return isNaN(parseFloat(a))?0:parseFloat(a)}function d(a){return Math.round(100*(a+1e-5))/100}var e=document.createElement("div");e.id="canvas_editor",e.style.border="none",e.style.borderWidth="0px",e.style.position="relative",e.style.top=this.top,e.style.left=this.left;var f;if(null!=(f=this.getProjection())){var g=f.fromLatLngToDivPixel(this.latlng);e.style.top=g.y-this.height/2+"px",e.style.left=g.x-this.width/2+"px"}var h=this;jQuery.getCorrection=function(a,b,c,d,e){var e=e*Math.PI/180,f=-a/2,g=b/2,h=g*Math.sin(e)+f*Math.cos(e),i=g*Math.cos(e)-f*Math.sin(e),j={left:h-f,top:i-g},k=a+c,l=b+d,f=-k/2,g=l/2,h=g*Math.sin(e)+f*Math.cos(e),i=g*Math.cos(e)-f*Math.sin(e),m={left:h-f,top:i-g};return{left:m.left-j.left,top:m.top-j.top}},jQuery.ui.resizable.prototype._mouseStart=function(b){var c,d,e,f=this.options,g=this.element;return this.resizing=!0,this._renderProxy(),c=a(this.helper.css("left")),d=a(this.helper.css("top")),f.containment&&(c+=$(f.containment).scrollLeft()||0,d+=$(f.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:c,top:d},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:g.width(),height:g.height()},this.originalSize=this._helper?{width:g.outerWidth(),height:g.outerHeight()}:{width:g.width(),height:g.height()},this.sizeDiff={width:g.outerWidth()-g.width(),height:g.outerHeight()-g.height()},this.originalPosition={left:c,top:d},this.originalMousePosition={left:b.pageX,top:b.pageY},this.lastData=this.originalPosition,this.aspectRatio="number"==typeof f.aspectRatio?f.aspectRatio:this.originalSize.width/this.originalSize.height||1,e=$(".ui-resizable-"+this.axis).css("cursor"),$("body").css("cursor","auto"===e?this.axis+"-resize":e),g.addClass("ui-resizable-resizing"),this._propagate("start",b),!0},jQuery.ui.resizable.prototype._mouseDrag=function(a){var e,f=b(this.element[0]),g=f*Math.PI/180,h=this.helper,i={},j=this.originalMousePosition,k=this.axis,l=this.position.top,m=this.position.left,n=this.size.width,o=this.size.height,p=a.pageX-j.left||0,q=a.pageY-j.top||0,r=this._change[k],s=this.size.width,t=this.size.height;if(!r)return!1;var u=Math.cos(g),v=Math.sin(g);ndx=p*u+q*v,ndy=q*u-p*v,p=ndx,q=ndy,e=r.apply(this,[a,p,q]),this._updateVirtualBoundaries(a.shiftKey),(this._aspectRatio||a.shiftKey)&&(e=this._updateRatio(e,a)),e=this._respectSize(e,a);var w={left:this.position.left,top:this.position.top};this._updateCache(e),this.position={left:w.left,top:w.top};var x={left:c(e.left||this.lastData.left)-c(this.lastData.left),top:c(e.top||this.lastData.top)-c(this.lastData.top)},y={};y.left=x.left*u-x.top*v,y.top=x.top*u+x.left*v,y.left=d(y.left),y.top=d(y.top),this.position.left+=y.left,this.position.top+=y.top,this.lastData={left:c(e.left||this.lastData.left),top:c(e.top||this.lastData.top)},this._propagate("resize",a);var z=s-this.size.width,A=t-this.size.height,B=$.getCorrection(s,t,z,A,f);return this.position.left+=B.left,this.position.top-=B.top,this.position.top!==l&&(i.top=this.position.top+"px"),this.position.left!==m&&(i.left=this.position.left+"px"),this.size.width!==n&&(i.width=this.size.width+"px"),this.size.height!==o&&(i.height=this.size.height+"px"),h.css(i),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),$.isEmptyObject(i)||this._trigger("resize",a,this.ui()),!1},jQuery(e).resizable({ghost:!0,handles:"sw, se, nw, ne",helper:"resizable-helper",aspectRatio:!1,stop:function(a,b){h.ctx.clearRect(0,0,h.ctx.canvas.width,h.ctx.canvas.height),h.width=b.size.width,h.height=b.size.height,h.setCanvasSize(),h.ctx.save(),h.ctx.translate(h.ctx.canvas.width/2,h.ctx.canvas.height/2),h.ctx.drawImage(h.image_,-h.width/2,-h.height/2,h.width,h.height),h.ctx.restore()}}).rotatable({stop:function(a,b){}}),jQuery(e).draggable({stop:function(a,b){if(null!=f){var c=$(this).position().left,d=$(this).position().top;h.latlng=f.fromDivPixelToLatLng(new google.maps.Point(c,d),!0)}}});var i=document.createElement("canvas");return i.id="canvas",e.appendChild(i),this.div_=e,this.canvas=i,this.ctx=i.getContext("2d"),this.initImage(),this.getPanes().overlayImage.appendChild(this.div_),this},CanvasOverlay.prototype.draw=function(){this.div_;null==this.canvas&&alert("error creating the canvas")},CanvasOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_)},CanvasOverlay.prototype.hide=function(){this.div_&&(this.div_.style.visibility="hidden")},CanvasOverlay.prototype.show=function(){this.div_&&(this.div_.style.visibility="visible")},CanvasOverlay.prototype.toggle=function(){this.div_&&("hidden"==this.div_.style.visibility?this.show():this.hide())},CanvasOverlay.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(this.map_)},CanvasOverlay.prototype.getCanvas=function(){return this.canvas},CanvasOverlay.prototype.getContext2d=function(){return this.ctx},CanvasOverlay.prototype.setCanvasSize=function(){this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.div_.style.width=this.width+"px",this.div_.style.height=this.height+"px"},CanvasOverlay.prototype.initImage=function(){this.setCanvasSize(),this.ctx.save(),this.ctx.translate(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.ctx.rotate(this.angle),this.ctx.drawImage(this.image_,-this.width/2,-this.height/2,this.width,this.height),this.ctx.restore()},CanvasOverlay.prototype.drawBoundingCanvas=function(){var a=getRotationDegrees($("#canvas_editor")),b=deg2rad(a);$("#canvas_editor").css({"-moz-transform":"rotate(0deg)","-webkit-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)","-o-transform":"rotate(0deg)",transform:"rotate(0deg)"});var c=getPositionData($("#canvas_editor")),d=c.left,e=c.top,f=d+this.width/2,g=e+this.height/2,h=f+(d-f)*Math.cos(b)+(e-g)*Math.sin(b),i=g-(d-f)*Math.sin(b)+(e-g)*Math.cos(b),j=f+(d+this.width-f)*Math.cos(b)+(e-g)*Math.sin(b),k=g-(d+this.width-f)*Math.sin(b)+(e-g)*Math.cos(b),l=f+(d-f)*Math.cos(b)+(e+this.height-g)*Math.sin(b),m=g-(d-f)*Math.sin(b)+(e+this.height-g)*Math.cos(b),n=f+(d+this.width-f)*Math.cos(b)+(e+this.height-g)*Math.sin(b),o=g-(d+this.width-f)*Math.sin(b)+(e+this.height-g)*Math.cos(b),p=Math.max(h,j,l,n),q=Math.max(i,k,m,o),r=Math.min(h,j,l,n),s=Math.min(i,k,m,o),t=s,u=r,v=p-r,w=q-s;$("#canvas_editor").css({top:t+"px",left:u+"px"}),this.ctx.canvas.width=v,this.ctx.canvas.height=w,this.ctx.save(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.translate(f-u,g-t),this.ctx.rotate(b),this.ctx.drawImage(this.image_,-this.width/2,-this.height/2,this.width,this.height),this.ctx.restore(),this.top=t,this.left=u;var x;null!=(x=this.getProjection())&&(this.bottom_left_coords=x.fromContainerPixelToLatLng(new google.maps.Point(this.left,this.top+w),!0),this.top_right_coords=x.fromContainerPixelToLatLng(new google.maps.Point(this.left+v,this.top),!0))};var getPositionData=function(a){return $.extend({width:a.outerWidth(!1),height:a.outerHeight(!1)},a.offset())},LPUtils={};LPUtils.isNullOrUndefined=function(a){return void 0===a||null===a},LPUtils.isStringEmptyNullUndefined=function(a){return!a||0===a.length},LPUtils.isStringBlankNullUndefined=function(a){return!a||/^\s*$/.test(a)},LPUtils.alert=function(a){document.getElementById("notification_panel").innerHTML='<alert type="error" close="LPUtils.closeAlert()">'+a+"</alert>"},LPUtils.closeAlert=function(){document.getElementById("notification_panel").getEl.innerHTML=""},LPUtils.success=function(a){document.getElementById("notification_panel").innerHTML='<alert type="success">'+a+"</alert>"},LPUtils.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=LPUtils.Base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=LPUtils.Base64._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}},LPUtils.Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(a){var b=a.length/4*3,c=new ArrayBuffer(b);return this.decode(a,c),c},decode:function(a,b){var c=this._keyStr.indexOf(a.charAt(a.length-1)),d=this._keyStr.indexOf(a.charAt(a.length-2)),e=a.length/4*3;64==c&&e--,64==d&&e--;var f,g,h,i,j,k,l,m,n=0,o=0;for(f=b?new Uint8Array(b):new Uint8Array(e),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),n=0;n<e;n+=3)j=this._keyStr.indexOf(a.charAt(o++)),k=this._keyStr.indexOf(a.charAt(o++)),l=this._keyStr.indexOf(a.charAt(o++)),m=this._keyStr.indexOf(a.charAt(o++)),g=j<<2|k>>4,h=(15&k)<<4|l>>2,i=(3&l)<<6|m,f[n]=g,
64!=l&&(f[n+1]=h),64!=m&&(f[n+2]=i);return f}},USGSOverlay.prototype=new google.maps.OverlayView,USGSOverlay.prototype.onAdd=function(){var a=document.createElement("div");a.id="ground_overlay",a.style.borderStyle="none",a.style.borderWidth="0px",a.style.position="absolute";var b=document.createElement("img");b.src=this.image64,b.style.width="100%",b.style.height="100%",b.style.position="absolute",a.appendChild(b),this.div_=a,this.getPanes().overlayLayer.appendChild(a)},USGSOverlay.prototype.draw=function(){var a=this.getProjection(),b=a.fromLatLngToDivPixel(this.bounds_.getSouthWest()),c=a.fromLatLngToDivPixel(this.bounds_.getNorthEast()),d=this.div_;d.style.left=b.x+"px",d.style.top=c.y+"px",d.style.width=c.x-b.x+"px",d.style.height=b.y-c.y+"px"},USGSOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},app.controller("AlertController",["$rootScope","$scope","AnyplaceService",function(a,b,c){b.anyService=c,b.alerts=c.alerts,b.closeable=!0}]),app.controller("BuildingController",["$cookieStore","$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(a,b,c,d,e,f){function g(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function h(a){var c=a.target.files[0];if(c){var d=new FileReader;d.onload=function(a){var c=a.target.result;b.fileToUpload=c},d.readAsText(c)}}function i(){$("#myModal_Welcome").modal("show")}b.myMarkers={},b.myMarkerId=0,b.gmapService=d,b.anyService=e,b.anyAPI=f,b.example9model=[],b.example9data=[],b.example9settings={enableSearch:!0,scrollable:!0},b.example9modeledit=[],b.example9dataedit=[],b.example9settingsedit={enableSearch:!0,scrollable:!0},b.myBuildings=[],b.myBuildingsHashT={},b.myCampus=[],b.old_campus=[],b.crudTabSelected=1,b.fileToUpload="",b.logfile="",b.poisTypes={},b.catTypes={},b.pageLoad=!1,b.crudTabSelected=1,b.setCrudTabSelected=function(a){if(b.crudTabSelected=a,!b.anyService.getBuilding())return void m("No building is selected.");var c=b.myBuildingsHashT[b.anyService.getBuildingId()];if(c){var d=c.marker;d&&(2===a?d.setDraggable(!0):d.setDraggable(!1))}},b.isCrudTabSelected=function(a){return b.crudTabSelected===a},b.$on("loggedIn",function(a,c){b.fetchAllBuildings(),b.fetchAllCampus()}),b.$on("loggedOff",function(a,c){l(),b.myMarkers={},b.myMarkerId=0,b.myBuildings=[],b.myBuildingsHashT={}});var j=(g()+g()+"-"+g()+"-4"+g().substr(0,3)+"-"+g()+"-"+g()+g()+g()).toLowerCase(),k=new Date;document.getElementById("CampusID").value="cuid_"+j+"_"+k.getTime(),$("#input-logo").change(function(a){var b=new FileReader;b.onload=function(a){(new Image).src=a.target.result},b.readAsDataURL(a.target.files[0])}),b.setLogoPlan=function(a){var c={is_published:"true",cuid:a,logo:String(b.newFloorNumber),description:String(b.newFloorNumber),floor_number:String(b.newFloorNumber)};b.myFloors[b.myFloorId]=c,b.myFloorId++,canvasOverlay.drawBoundingCanvas();var e=canvasOverlay.bottom_left_coords,f=canvasOverlay.top_right_coords;b.data.floor_plan_coords.bottom_left_lat=e.lat(),b.data.floor_plan_coords.bottom_left_lng=e.lng(),b.data.floor_plan_coords.top_right_lat=f.lat(),b.data.floor_plan_coords.top_right_lng=f.lng();var g=canvasOverlay.getCanvas().toDataURL("image/png");b.data.floor_plan_base64_data=g;var h=new google.maps.LatLngBounds(new google.maps.LatLng(e.lat(),e.lng()),new google.maps.LatLng(f.lat(),f.lng()));if(b.data.floor_plan_groundOverlay=new USGSOverlay(h,g,d.gmap),canvasOverlay.setMap(null),$("#input-floor-plan").prop("disabled",!1),b.isCanvasOverlayActive=!1,_floorNoExists(b.newFloorNumber))for(var i=0;i<b.xFloors.length;i++){var j=b.xFloors[i];if(!LPUtils.isNullOrUndefined(j)&&j.floor_number===String(b.newFloorNumber)){b.uploadFloorPlanBase64(b.anyService.selectedBuilding,j,b.data);break}}else b.addFloorObject(c,b.anyService.selectedBuilding,b.data)},b.$watch("anyService.selectedBuilding",function(a,c){a&&a.coordinates_lat&&a.coordinates_lon&&(b.gmapService.gmap.panTo(o(a)),b.gmapService.gmap.setZoom(19),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastBuilding",a.buid)),b.poisTypes=["Disabled Toilets","Elevator","Entrance","Fire Extinguisher","First Aid/AED","Kitchen","Office","Ramp","Room","Security/Guard","Stair","Toilets","Other"]}),b.$watch("anyService.selectedCampus",function(a,b){a&&a.cuid&&"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastCampus",a.cuid)});var l=function(){for(var a in b.myBuildingsHashT)b.myBuildingsHashT.hasOwnProperty(a)&&(b.myBuildingsHashT[a].marker.setMap(null),delete b.myBuildingsHashT[a])},m=function(a){b.anyService.addAlert("danger",a)},n=function(a){b.anyService.addAlert("success",a)},o=function(a){if(a&&a.coordinates_lat&&a.coordinates_lon)return{lat:parseFloat(a.coordinates_lat),lng:parseFloat(a.coordinates_lon)}};b.fetchAllPoisTypes=function(){var a={};if(a.username=b.creds.username,a.password=b.creds.password,a.access_token=b.gAuth.access_token,a.owner_id=b.owner_id,!a.owner_id)return void m("Could nor authorize user. Please refresh.1");b.anyAPI.retrievePoisTypes(a).then(function(a){var c=a.data;b.catTypes=c.poistypes},function(a){a.data,m("Something went wrong while fetching POIs types")})},b.fetchAllBuildings=function(){var a={};if(a.username=b.creds.username,a.password=b.creds.password,a.owner_id=b.owner_id,!a.owner_id)return void m("Could nor authorize user. Please refresh.");b.anyAPI.allBuildings(a).then(function(a){var c=a.data;b.myBuildings=c.buildings;var e=new google.maps.InfoWindow({content:"-",maxWidth:500}),f=-1,g=void 0;"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastBuilding")&&(g=localStorage.getItem("lastBuilding"));for(var h=0;h<b.myBuildings.length;h++){var i=b.myBuildings[h];b.example9data[h]={id:i.buid,label:i.name},b.example9dataedit[h]={id:i.buid,label:i.name},g&&g===i.buid&&(f=h),"true"===i.is_published||1==i.is_published?i.is_published=!0:i.is_published=!1;var j=new google.maps.Marker({position:o(i),map:d.gmap,icon:new google.maps.MarkerImage("build/images/building-icon.png",null,null,null,new google.maps.Size(54,54)),draggable:!1}),k='<div class="infowindow-scroll-fix"><h5>Building:</h5><span>'+i.name+'</span><h5>Description:</h5><textarea class="infowindow-text-area"  rows="3" readonly>'+i.description+"</textarea></div>";j.infoContent=k,j.building=i,b.myBuildingsHashT[i.buid]={marker:j,model:i},google.maps.event.addListener(j,"click",function(){e.setContent(this.infoContent),e.open(d.gmap,this);var a=this;b.$apply(function(){b.anyService.selectedBuilding=a.building})})}f>=0?b.anyService.selectedBuilding=b.myBuildings[f]:b.myBuildings[0]&&(b.anyService.selectedBuilding=b.myBuildings[0])},function(a){a.data,m("Something went wrong while fetching buildings.")})},b.addNewBuilding=function(a){if(b.myMarkers[a]&&b.myMarkers[a].marker){var c=b.myMarkers[a].model;if(c.owner_id=b.owner_id,!c.owner_id)return void m("Could not authorize user. Please refresh.");if(c.coordinates_lat=String(b.myMarkers[a].marker.position.lat()),c.coordinates_lon=String(b.myMarkers[a].marker.position.lng()),void 0===c.coordinates_lat||null===c.coordinates_lat)return void m("Invalid building latitude.");if(void 0===c.coordinates_lon||null===c.coordinates_lon)return void m("Invalid building longitude.");if(!0===c.is_published?c.is_published="true":c.is_published="false",c.description||(c.description="-"),c.owner_id&&c.name&&c.description&&c.is_published&&c.url&&c.address){b.anyAPI.addBuilding(c).then(function(d){var e=d.data;console.log("new buid: "+e.buid),c.buid=e.buid,"true"===c.is_published||1==c.is_published?c.is_published=!0:c.is_published=!1,b.myBuildings.push(c),b.anyService.selectedBuilding=b.myBuildings[b.myBuildings.length-1],b.myMarkers[a].marker.setDraggable(!1),b.myBuildingsHashT[c.buid]={marker:b.myMarkers[a].marker,model:c},b.myMarkers[a].infowindow&&(b.myMarkers[a].infowindow.setContent(b.myMarkers[a].marker.tpl2[0]),b.myMarkers[a].infowindow.close()),n("Building added successfully.")},function(a){var b=a.data;m("Something went wrong while adding the building. "+b.message)})}else m("Some required fields are missing.")}},b.deleteBuilding=function(){var a=b.anyService.getBuilding(),c=b.creds;return b.owner_id?(c.owner_id=b.owner_id,a&&a.buid?(c.buid=a.buid,void b.anyAPI.deleteBuilding(c).then(function(c){c.data,console.log("building deleted: ",a),b.myBuildingsHashT[a.buid].marker.setMap(null),delete b.myBuildingsHashT[a.buid];for(var d=b.myBuildings,e=d.length,f=0;f<e;f++)if(d[f].buid==a.buid){d.splice(f,1);break}b.myBuildings&&b.myBuildings.length>0&&(b.anyService.selectedBuilding=b.myBuildings[0]),b.setCrudTabSelected(1),n("Successfully deleted building.")},function(a){a.data,m("Something went wrong. It's likely that everything related to the building is deleted but please refresh to make sure or try again.")})):void m("No building selected for deletion.")):void m("Could not identify user. Please refresh and sign in again.")},b.updateBuilding=function(){var a=b.anyService.getBuilding();if(LPUtils.isNullOrUndefined(a)||LPUtils.isNullOrUndefined(a.buid))return void m("No building selected found.");var c={};if(c=b.creds,!b.owner_id)return void m("Could not identify user. Please refresh and sign in again.");c.owner_id=b.owner_id,c.buid=a.buid,a.description&&(c.description=a.description),a.name&&(c.name=a.name),!0===a.is_published||"true"==a.is_published?c.is_published="true":c.is_published="false",a.bucode&&(c.bucode=a.bucode);var d=b.myBuildingsHashT[a.buid].marker;if(d){var e=d.position;e&&e.lat()&&e.lng()&&(c.coordinates_lat=String(e.lat()),c.coordinates_lon=String(e.lng()))}b.anyAPI.updateBuilding(c).then(function(b){b.data,"true"===a.is_published||1==a.is_published?a.is_published=!0:a.is_published=!1,n("Successfully updated building.")},function(a){var b=a.data;m("Something went wrong while updating building. "+b.message)})},b.fetchAllCampus=function(){var a={};if(a.username=b.creds.username,a.password=b.creds.password,a.owner_id=b.owner_id,b.myCampus=[],!a.owner_id)return void m("Could nor authorize user. Please refresh.");b.anyAPI.allCampus(a).then(function(a){var c=a.data;b.myCampus=c.buildingsets;var d=-1,e=void 0;"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastCampus")&&(e=localStorage.getItem("lastCampus"));for(var f=0;f<b.myCampus.length;f++){var g=b.myCampus[f];e&&e===g.cuid&&(d=f)}d>=0?b.anyService.selectedCampus=b.myCampus[d]:b.myCampus[0]&&(b.anyService.selectedCampus=b.myCampus[0])},function(a){a.data,m("Something went wrong while fetching buildings.")})},b.updateCampus=function(){var a=b.anyService.getCampus();if(LPUtils.isNullOrUndefined(a)||LPUtils.isNullOrUndefined(a.cuid))return void m("No campus selected found.");var c={};if(c=b.creds,!b.owner_id)return void m("Could not identify user. Please refresh and sign in again.");c.owner_id=b.owner_id,c.cuid=a.cuid,a.description&&(c.description=a.description),a.name&&(c.name=a.name),a.newcuid&&(c.newcuid=a.newcuid);var d=b.example9modeledit.length;if(0==d)return void m("No buildings selected.");for(var e='"buids":[',f=d-1;f>0;f--)e=e+'"'+b.example9modeledit[f].id+'",';e=e+'"'+b.example9modeledit[0].id+'"]',c.greeklish=document.getElementById("Greeklish-OnOffedit").checked,c.buids=e,b.anyAPI.updateCampus(c).then(function(a){a.data,document.getElementById("CampusIDeditnew").value="",n("Successfully updated campus.")},function(a){var b=a.data;m("Something went wrong while updating campus. "+b.message)})},b.deleteCampus=function(){var a=b.anyService.getCampus(),c=b.creds;return b.owner_id?(c.owner_id=b.owner_id,a&&a.cuid?(c.cuid=a.cuid,void b.anyAPI.deleteCampus(c).then(function(c){c.data,console.log("campus deleted: ",a);for(var d=b.myCampus,e=d.length,f=0;f<e;f++)if(d[f].cuid==a.cuid){d.splice(f,1);break}b.myCampus&&b.myCampus.length>0?b.anyService.selectedCampus=b.myCampus[0]:0==b.myCampus.length&&(b.anyService.selectedCampus=void 0),b.setCrudTabSelected(1),n("Successfully deleted campus.")},function(a){a.data,m("Something went wrong. It's likely that everything related to the campus is deleted but please refresh to make sure or try again.")})):void m("No Campus selected for deletion.")):void m("Could not identify user. Please refresh and sign in again.")},b.addCampus=function(){var a=document.getElementById("CampusName"),c='"name":"'+a.value+'"';0==document.getElementById("CampusDescription").value.localeCompare("")&&(document.getElementById("CampusDescription").value="-");var d=document.getElementById("CampusDescription"),d='"description":"'+d.value+'"',e=document.getElementById("CampusID"),e='"cuid":"'+e.value+'"',f=document.getElementById("Greeklish-OnOff").checked;f='"greeklish":"'+f+'"';var g=b.example9model.length;if(0==g)return void m("No buildings selected.");for(var h='"buids":[',i=g-1;i>0;i--)h=h+'"'+b.example9model[i].id+'",';h=h+'"'+b.example9model[0].id+'"]';var j="{"+f+","+h+","+e+","+d+","+c+',"owner_id":"'+b.owner_id+'","access_token":"'+b.gAuth.access_token+'"}';b.anyAPI.addBuildingSet(j).then(function(a){function c(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var d=a.data,e={};e.name=document.getElementById("CampusName").value,e.buids=h.buids,e.description=document.getElementById("CampusDescription").value,e.cuid=d.cuid,b.myCampus.push(e),b.anyService.selectedCampus=b.myCampus[b.myCampus.length-1],n("Successfully added campus.");var f=(c()+c()+"-"+c()+"-4"+c().substr(0,3)+"-"+c()+"-"+c()+c()+c()).toLowerCase(),g=new Date;document.getElementById("CampusID").value="cuid_"+f+"_"+g.getTime()},function(a){var b=a.data;m("Something went wrong while adding the building. "+b.message)})};var p=new google.maps.OverlayView;p.draw=function(){},p.setMap(d.gmap),$("#draggable-building").draggable({helper:"clone",stop:function(a){var c=new google.maps.Point(a.pageX,a.pageY),d=p.getProjection().fromContainerPixelToLatLng(c);b.placeMarker(d)}}),b.placeMarker=function(a){var e=b.myMarkers[b.myMarkerId-1];if(e&&e.marker&&e.marker.getMap()&&e.marker.getDraggable())return void console.log("there is a building pending, please add 1 at a time");var f=new google.maps.Marker({position:a,map:d.gmap,icon:"build/images/building-icon.png",draggable:!0}),g=new google.maps.InfoWindow({content:"-",maxWidth:500});b.$apply(function(){f.myId=b.myMarkerId,b.myMarkers[f.myId]={},b.myMarkers[f.myId].model={description:"",name:void 0,is_published:!0,address:"-",url:"-",bucode:""},b.myMarkers[f.myId].marker=f,b.myMarkers[f.myId].infowindow=g,b.myMarkerId++});var h='<form name="buildingForm" class="infowindow-scroll-fix"><fieldset class="form-group"><input ng-model="myMarkers['+f.myId+'].model.bucode" id="building-code" type="text" class="form-control" placeholder="Building Code (Optional)"/></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+f.myId+'].model.name" id="building-name" type="text" class="form-control" placeholder="Building Name *"/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+f.myId+'].model.description" id="building-description" type="text" class="form-control" placeholder="Building Description (Optional)"></textarea></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+f.myId+'].model.is_published" id="building-published" type="checkbox"><span> Make building public to view.</span></fieldset><fieldset class="form-group"></fieldset class="form-group"><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addNewBuilding('+f.myId+')"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempBuilding('+f.myId+')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form>',i='<div class="infowindow-scroll-fix"><h5 style="margin: 0">Building:</h5><span>{{myMarkers['+f.myId+'].model.name}}</span><h5 style="margin: 8px 0 0 0">Description:</h5><span>{{myMarkers['+f.myId+"].model.description}}</span></div>",j=c(h)(b);f.tpl2=c(i)(b),g.setContent(j[0]),g.open(d.gmap,f),google.maps.event.addListener(f,"click",function(){g.getMap()||g.open(d.gmap,f)})},b.deleteTempBuilding=function(a){var c=b.myMarkers[a];c&&c.marker&&c.marker.setMap(null)},b.exportBuildingToJson=function(){var a={building:{floors:[]}},c=b.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(c))return void m("No building selected");a.building.buid=c.buid,a.building.name=c.name,a.building.description=c.description,a.building.coordinates_lat=c.coordinates_lat,a.building.coordinates_lon=c.coordinates_lon;var d=e.jsonReq;d.buid=c.buid;var g=0;f.allBuildingFloors(d).then(function(b){var d=b.data.floors,e=[];if(d)for(var h=0;h<d.length;h++)!function(b){f.retrievePoisByBuildingFloor(b).then(function(b){var f=b.data,h=f.pois;if(h){for(var i=[],j=h[0].floor_number,k=0;k<h.length;k++){var l=h[k];if("None"!=l.pois_type){if(l.overwrite)var m={name:l.name,description:l.description,puid:l.puid,pois_type:l.pois_type,coordinates_lat:l.coordinates_lat,coordinates_lon:l.coordinates_lon,overwrite:l.overwrite};else var m={name:l.name,description:l.description,puid:l.puid,pois_type:l.pois_type,coordinates_lat:l.coordinates_lat,coordinates_lon:l.coordinates_lon,overwrite:"false"};i.push(m)}}if(e.push({floor_number:j,pois:i}),++g===d.length){a.building.floors=e,n("Successfully exported "+c.name+" to JSON.");var o=new Blob([JSON.stringify(a,null,4)],{type:"text/plain;charset=utf-8"});saveAs(o,c.name.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt")}}},function(a){var b=a.data;console.log(b.message)})}({buid:c.buid,floor_number:d[h].floor_number})},function(a){console.log(a.data.message)})},b.exportCampusToJson=function(){var a={campus:{buids:[]}},c=b.anyService.selectedCampus;if(LPUtils.isNullOrUndefined(c))return void m("No campus selected");a.campus.name=c.name,a.campus.description=c.description,a.campus.buids=c.buids,n("Successfully exported "+c.name+" to JSON.");var d=new Blob([JSON.stringify(a,null,4)],{type:"text/plain;charset=utf-8"});saveAs(d,c.name.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt")},document.getElementById("file-input").addEventListener("change",h,!1),b.anyService.downloadlogfile=!1,b.importBuildingFromJson=function(){b.anyService.progress=0;var a,c,d=0,e=0;""==b.fileToUpload&&m("Something went wrong no file selected");var f=JSON.parse(b.fileToUpload);for(a=0;a<f.building.floors.length;a++)for(c=0;c<f.building.floors[a].pois.length;c++)"true"==f.building.floors[a].pois[c].overwrite&&d++;for(0==d&&m("Something went wrong no pois to update"),a=0;a<f.building.floors.length;a++)for(c=0;c<f.building.floors[a].pois.length;c++)"true"==f.building.floors[a].pois[c].overwrite&&(e++,b.updatePoifromFile(f.building.floors[a].pois[c].puid,f.building.floors[a].pois[c].coordinates_lat,f.building.floors[a].pois[c].coordinates_lon,f.building.floors[a].pois[c].name,f.building.floors[a].pois[c].description,f.building.floors[a].pois[c].pois_type,f.building.floors[a].pois[c].overwrite,f.building.buid,a,c,d,e,f.building.name))},b.allpois={},b.pois={},b.importBuildingFromExcel=function(a){b.anyService.progress=0;var c=document.getElementById("my_file_input").files[0];b.fileToUpload=c.name;var d=new FileReader;d.onload=function(a){var c=a.target.result,d=XLS.CFB.read(c,{type:"binary"}),e=XLS.parse_xlscfb(d);e.SheetNames.forEach(function(a){var c=XLS.utils.sheet_to_row_object_array(e.Sheets[a]);b.uploadloop(0,c,"")})},d.readAsBinaryString(c)},b.uploadloop=function(a,c,d){for(var e=a;e<c.length;e++){if(d!=c[e].buid&&void 0!=c[e].buid)return b.pois={},d=c[e].buid,void b.fetchAllPoisForBuilding(c[e].buid,c,e,d);var f="";void 0!=c[e].des3&&""!=c[e].des3&&null!=c[e].des3?void 0!=c[e].des4&&""!=c[e].des4&&null!=c[e].des4?f=f+c[e].des3+" "+c[e].des4:f+=c[e].des3:void 0!=c[e].des4&&""!=c[e].des4&&null!=c[e].des4&&(f+=c[e].des4),void 0!=c[e].des1&&""!=c[e].des1&&null!=c[e].des1&&(""!=f?f=f+"\n"+c[e].des1:f+=c[e].des1),void 0!=c[e].des2&&""!=c[e].des2&&null!=c[e].des2&&(""!=f?f=f+"\n"+c[e].des2:f+=c[e].des2),b.anyService.progress=e/(c.length-1)*100,c.length-1==0&&(b.anyService.progress=100),b.pois[c[e].name]?b.updatePoifromExcel(b.pois[c[e].name].puid,b.pois[c[e].name].coordinates_lat,b.pois[c[e].name].coordinates_lon,b.pois[c[e].name].is_building_entrance,c[e].name,f,b.pois[c[e].name].pois_type,b.pois[c[e].name].overwrite,b.pois[c[e].name].buid,""):b.updatePoifromExcel("","","","",c[e].name,f,"","","","")}},b.fetchAllPoisForBuilding=function(a,c,d,g){var h=e.jsonReq;h.buid=a,f.retrievePoisByBuilding(h).then(function(a){var e=a.data;b.myPois=e.pois;for(var f=b.myPois.length,h=f-1;h>=0;h--){var i=b.myPois[h].name;b.pois[i]=b.myPois[h]}b.uploadloop(d,c,g)},function(a){a.data,m("Something went wrong while fetching POIs")})},b.logfile={pois:[]},b.updatePoifromExcel=function(a,c,d,e,f,g,h,i,j,k){var l={};l.username=b.creds.username,l.password=b.creds.password,l.owner_id=b.owner_id,l.coordinates_lat=c,l.coordinates_lon=d,l.is_building_entrance=e,l.name=f,l.puid=a,l.description=g,l.pois_type=h,l.overwrite="false",l.buid=j,b.anyAPI.updatePois(l).then(function(a){if(a.data,100==b.anyService.progress)if(b.anyService.downloadlogfile){b.anyService.downloadlogfile=!1,n("Successfully updated POIs.A log file will be downloaded");var c=new Blob([JSON.stringify(b.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(c,(b.fileToUpload+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),setTimeout(function(){b.anyService.progress=void 0},2500)}else n("Successfully updated POIs."),setTimeout(function(){b.anyService.progress=void 0,location.reload()},2500)},function(c){if(c.data,b.logfile.pois.push({name:f,puid:a,description:g,status:"Something went wrong while updating POI."}),b.anyService.downloadlogfile=!0,100==b.anyService.progress){b.anyService.downloadlogfile=!1,n("Successfully updated POIs.A log file will be downloaded");var d=new Blob([JSON.stringify(b.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(d,(b.fileToUpload+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),b.logfile.pois=[],setTimeout(function(){b.anyService.progress=void 0},2500)}})},b.updatePoifromFile=function(a,c,d,e,f,g,h,i,j,k,l,m,o){var p={};p.username=b.creds.username,p.password=b.creds.password,p.owner_id=b.owner_id,p.coordinates_lat=c,p.coordinates_lon=d,p.name=e,p.puid=a,p.description=f,p.pois_type=g,p.overwrite="false",p.buid=i,b.anyAPI.updatePois(p).then(function(a){if(a.data,b.anyService.progress=m/l*100,100==b.anyService.progress)if(b.anyService.downloadlogfile){n("Successfully updated POIs.A log file will be downloaded");var c=new Blob([JSON.stringify(b.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(c,(o+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),setTimeout(function(){b.anyService.progress=void 0},2500)}else n("Successfully updated POIs."),setTimeout(function(){b.anyService.progress=void 0,location.reload()},2500)},function(c){if(c.data,b.logfile.pois.push({name:e,puid:a,description:f,status:"Something went wrong while updating POI."}),b.anyService.downloadlogfile=!0,b.anyService.progress=m/l*100,100==b.anyService.progress)if(b.anyService.downloadlogfile){n("Successfully updated POIs.A log file will be downloaded");var d=new Blob([JSON.stringify(b.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(d,(o+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),b.logfile.pois=[],setTimeout(function(){b.anyService.progress=void 0},2500)}else n("Successfully updated POIs."),setTimeout(function(){b.anyService.progress=void 0,location.reload()},2500)})},b.Poisresult={building:{floors:[]}},b.Connectionsresult={building:{}},b.zip=new JSZip,b.DownloadBackup=function(){var a=b.anyService.selectedBuilding,c=[],d=e.jsonReq;d.buid=a.buid,b.anyService.progress=0,f.allBuildingFloors(d).then(function(d){c=d.data.floors;for(var g="",h=0;h<c.length;h++)g=0==h?c[h].floor_number:g+" "+c[h].floor_number;b.anyService.progress=10;var i=a.buid,j=e.jsonReq;f.downloadFloorPlanAll(j,i,g).then(function(a){for(var d=a.data,h=b.zip.folder("floor_plans"),j=0;j<d.all_floors.length;j++)""!=d.all_floors[j]&&h.file(c[j].floor_number+".png",d.all_floors[j],{base64:!0});b.anyService.progress=25;var k=e.jsonReq;k.buid=i,k.floor=g,f.getRadioByBuildingFloorAll(k).then(function(a){var d=a.data,e=b.zip.folder("radiomaps");if(d.rss_log_files)for(var f=0;f<d.rss_log_files.length;f++)e.file(c[f].floor_number+"-radiomap.txt",d.rss_log_files[f]);b.anyService.progress=70,b.exportPoisBuildingToJson()},function(a){})},function(a){})},function(a){console.log(a.data.message),m("Something went wrong while fetching all floors")})},b.exportPoisBuildingToJson=function(){var a=b.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(a))return void m("No building selected");b.Poisresult.building.buid=a.buid,b.Poisresult.building.name=a.name,b.Poisresult.building.description=a.description,b.Poisresult.building.coordinates_lat=a.coordinates_lat,b.Poisresult.building.coordinates_lon=a.coordinates_lon;var c=e.jsonReq;c.buid=a.buid;var d=0;f.allBuildingFloors(c).then(function(c){var e=c.data.floors,g=[];if(b.anyService.progress=80,e)for(var h=0;h<e.length;h++)!function(a){f.retrievePoisByBuildingFloor(a).then(function(a){var c=a.data,f=c.pois;if(f){var h=[];if(void 0!=f[0]){for(var i=f[0].floor_number,j=0;j<f.length;j++){var k=f[j];if("None"!=k.pois_type){if(k.overwrite)var l={name:k.name,description:k.description,puid:k.puid,pois_type:k.pois_type,coordinates_lat:k.coordinates_lat,coordinates_lon:k.coordinates_lon,overwrite:k.overwrite};else var l={name:k.name,description:k.description,puid:k.puid,pois_type:k.pois_type,coordinates_lat:k.coordinates_lat,coordinates_lon:k.coordinates_lon,overwrite:"false"};"true"==k.is_building_entrance?l.is_building_entrance="true":l.is_building_entrance="false",h.push(l)}}g.push({floor_number:i,pois:h})}++d===e.length&&(b.Poisresult.building.floors=g,b.zip.file("allpois.json",JSON.stringify(b.Poisresult,null,4)),b.anyService.progress=90,b.exportConnectionBuildingToJson())}},function(a){var b=a.data;console.log(b.message)})}({buid:a.buid,floor_number:e[h].floor_number})},function(a){console.log(a.data.message)})},b.exportConnectionBuildingToJson=function(){var a=b.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(a))return void m("No building selected");b.Connectionsresult.building.buid=a.buid,b.Connectionsresult.building.name=a.name,b.Connectionsresult.building.description=a.description,b.Connectionsresult.building.coordinates_lat=a.coordinates_lat,b.Connectionsresult.building.coordinates_lon=a.coordinates_lon;var c=e.jsonReq;c.buid=a.buid;var d=0;f.allBuildingFloors(c).then(function(c){var e=c.data.floors,g=[];if(e)for(var h=0;h<e.length;h++)!function(c){f.retrieveConnectionsByBuildingFloor(c).then(function(c){b.anyService.progress=100;var f=c.data,h=f.connections;if(h){var i=[];if(void 0!=h[0]){for(var j=h[0].floor_a,k=0;k<h.length;k++){var l=h[k],m={name:l.name,description:l.description,cuid:l.puid,weight:l.weight,pois_a:l.pois_a,pois_b:l.pois_b,floor_a:l.floor_a,floor_b:l.floor_b,is_published:l.is_published,buid_a:l.buid_a,buid_b:l.buid_b};i.push(m)}g.push({floor_number:j,connections:i})}++d===e.length&&(b.Connectionsresult.building.floors=g,b.zip.file("allconnections.json",JSON.stringify(b.Connectionsresult,null,4)),b.zip.generateAsync({type:"blob"}).then(function(b){saveAs(b,a.buid+".zip")}),b.anyService.progress=void 0)}},function(a){var b=a.data;console.log(b.message)})}({buid:a.buid,floor_number:e[h].floor_number})},function(a){console.log(a.data.message)})},$("#dismiss").on("click",function(){"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("dismissClicked","YES")}),"YES"!==localStorage.getItem("dismissClicked")&&(window.onload=i)}]),app.controller("ControlBarController",["$scope","$rootScope","AnyplaceService","GMapService","AnyplaceAPIService",function(a,b,c,d,e){a.anyService=c,a.gmapService=d,a.isAuthenticated=!1,a.signInType="google",a.gAuth={},a.person=void 0,a.creds={username:"username",password:"password"},a.owner_id=void 0,a.displayName=void 0;a.setAuthenticated=function(b){a.isAuthenticated=b},a.showFullControls=!0,a.toggleFullControls=function(){a.showFullControls=!a.showFullControls};a.showGoogleID=function(){a.person&&c.addAlert("success","Your Google ID is: "+a.person.id)},a.showGoogleAuth=function(){a.gAuth&&c.addAlert("success","access_token: "+a.gAuth.access_token)},a.onSignIn=function(b){""===a.getCookie("username")&&(a.setCookie("username","true",365),location.reload()),a.setAuthenticated(!0),a.gAuth=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse(),a.gAuth.access_token=a.gAuth.id_token,app.access_token=a.gAuth.id_token,a.personLookUp(b)},a.onSignInFailure=function(){console.log("Sign-in state: Error")},window.onSignIn=a.onSignIn,window.onSignInFailure=a.onSignInFailure,a.personLookUp=function(b){a.person=b.getBasicProfile(),a.person.image=a.person.getImageUrl(),a.person.id=a.person.getId(),a.person.displayName=a.person.getName(),a.owner_id=a.person.id+"_"+a.signInType,a.displayName=a.person.displayName,a.person&&a.person.id&&a.$broadcast("loggedIn",[]),e.signAccount({name:a.person.displayName,type:"google"}).then(function(a){},function(a){})},a.signOut=function(){a.setCookie("username","",365),gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out.")}),a.isAuthenticated=!1,a.$broadcast("loggedOff",[]),a.gAuth={},a.owner_id=void 0,a.person=void 0},a.getCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""},a.setCookie=function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e},a.tab=1,a.setTab=function(b){a.tab=b},a.isTabSet=function(b){return a.tab===b},a.tab=1,a.setTab=function(b){a.tab=b},a.isTabSet=function(b){return a.tab===b};var f=function(b){a.anyService.addAlert("danger",b)},g=void 0;a.userPosition=void 0;var h=!1;a.isUserLocVisible=!1,a.getIsUserLocVisible=function(){return a.isUserLocVisible},a.panToUserLocation=function(){a.userPosition&&(d.gmap.panTo(a.userPosition),d.gmap.setZoom(20))},a.displayMyLocMarker=function(a){if(g&&g.getMap())return void g.setPosition(a)},a.displayMyLocMarker=function(b){if(g&&g.getMap())return void g.setPosition(b);var c=new google.maps.Size(20,20);a.isFirefox&&(c=new google.maps.Size(48,48)),g=new google.maps.Marker({position:b,map:d.gmap,draggable:!1,icon:{url:"build/images/location-radius-centre.png",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,10),size:c,scaledSize:new google.maps.Size(20,20)}})},a.hideUserLocation=function(){g&&g.setMap(null),a.isUserLocVisible=!1},a.showUserLocation=function(){if(a.getIsUserLocVisible())return a.hideUserLocation(),void(navigator.geolocation&&navigator.geolocation.clearWatch(watchPosNum));navigator.geolocation?watchPosNum=navigator.geolocation.watchPosition(function(b){var c={lat:b.coords.latitude,lng:b.coords.longitude};a.userPosition=c,a.displayMyLocMarker(c);var e=new google.maps.InfoWindow({content:"Your current location.",maxWidth:500});google.maps.event.addListener(g,"click",function(){var b=this;a.$apply(function(){e.open(d.gmap,b)})}),a.isUserLocVisible||a.$apply(function(){a.isUserLocVisible=!0}),h||(d.gmap.panTo(c),d.gmap.setZoom(19),h=!0)},function(b){a.$apply(function(){f(1==b.code?"Permission denied. Anyplace was not able to retrieve your Geolocation.":2==b.code?"Position unavailable. The network is down or the positioning satellites couldn't be contacted.":3==b.code?"Timeout. The request for retrieving your Geolocation was timed out.":"There was an error while retrieving your Geolocation. Please try again.")})}):f("The Geolocation feature is not supported by this browser.")},a.centerViewToSelectedItem=function(){
if(null==a.anyService.selectedBuilding||void 0==a.anyService.selectedBuilding)return void f("You have to select a building first");var b={};if(a.anyService.selectedPoi){var c=a.anyService.selectedPoi;b={lat:parseFloat(c.coordinates_lat),lng:parseFloat(c.coordinates_lon)}}else{if(!a.anyService.selectedBuilding)return void f("No building is selected.");var d=a.anyService.selectedBuilding;b={lat:parseFloat(d.coordinates_lat),lng:parseFloat(d.coordinates_lon)}}a.gmapService.gmap.panTo(b),a.gmapService.gmap.setZoom(20)}}]);var changedfloor=!1;app.controller("FloorController",["$scope","AnyplaceService","GMapService","AnyplaceAPIService",function(a,b,c,d){a.anyService=b,a.anyAPI=d,a.gmapService=c,a.xFloors=[],a.myFloors={},a.myFloorId=0,a.newFloorNumber=0;var e;a.crudTabSelected=1,a.setCrudTabSelected=function(b){a.crudTabSelected=b},a.isCrudTabSelected=function(b){return a.crudTabSelected===b},a.data={floor_plan_coords:{},floor_plan_base64_data:{},floor_plan_groundOverlay:null},a.$on("loggedOff",function(a,b){f()});var f=function(){a.removeFloorPlan(),a.xFloors=[],a.myFloorId=0,a.myFloors={}};a.$watch("anyService.selectedBuilding",function(b,c){b&&(changedfloor=!1,a.fetchAllFloorsForBuilding(b))}),a.$watch("newFloorNumber",function(a,b){});var g=function(b){a.anyService.addAlert("danger",b)},h=function(b){a.anyService.addAlert("success",b)},i=function(a){if(a&&a.coordinates_lat&&a.coordinates_lon)return{lat:parseFloat(a.coordinates_lat),lng:parseFloat(a.coordinates_lon)}};a.$watch("anyService.selectedFloor",function(b,d){void 0===b||null===b||_.isEqual(b,d)||(a.fetchFloorPlanOverlay(b),c.gmap.panTo(i(a.anyService.selectedBuilding)),c.gmap.setZoom(19),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastFloor",b.floor_number),changedfloor=!1)}),a.fetchAllFloorsForBuilding=function(c){var e=b.jsonReq;e.buid=c.buid,d.allBuildingFloors(e).then(function(b){if(a.xFloors=b.data.floors,a.xFloors=a.xFloors.sort(function(a,b){return parseInt(a.floor_number)-parseInt(b.floor_number)}),a.anyService.availableFloors=[],a.anyService.availableFloors=a.xFloors,a.urlFloor)for(var c=0;c<a.xFloors.length;c++)if(a.urlFloor==a.xFloors[c].floor_number)return void(a.anyService.selectedFloor=a.xFloors[c]);if("undefined"!=typeof Storage&&localStorage&&!LPUtils.isNullOrUndefined(localStorage.getItem("lastBuilding"))&&!LPUtils.isNullOrUndefined(localStorage.getItem("lastFloor")))for(var d=0;d<a.xFloors.length;d++)if(String(a.xFloors[d].floor_number)===String(localStorage.getItem("lastFloor")))return void(a.anyService.selectedFloor=a.xFloors[d]);a.xFloors&&a.xFloors.length>0?a.anyService.selectedFloor=a.xFloors[0]:a.anyService.selectedFloor=void 0,j()},function(a){console.log(a.data.message),g("Something went wrong while fetching all floors")})};var j=function(){for(var b=-1,c=0;c<a.xFloors.length;c++)parseInt(a.xFloors[c].floor_number)>=b&&(b=parseInt(a.xFloors[c].floor_number));a.newFloorNumber=b+1},k=function(a){return null!==a&&void 0!=a&&(null!==a.floor_number&&void 0!==a.floor_number)};a.fetchFloorPlanOverlay=function(){if(!k(this.anyService.selectedFloor))return void console.log("something is wrong with the floor");var b=this.anyService.selectedFloor.floor_number,e=this.anyService.selectedBuilding.buid;d.downloadFloorPlan(this.anyService.jsonReq,e,b).then(function(b){a.data.floor_plan_file=null,a.data.floor_plan=null,null!=a.data.floor_plan_groundOverlay&&(a.data.floor_plan_groundOverlay.setMap(null),a.data.floor_plan_groundOverlay=null);var d=b.data,e=a.anyService.selectedFloor,f=new google.maps.LatLngBounds(new google.maps.LatLng(e.bottom_left_lat,e.bottom_left_lng),new google.maps.LatLng(e.top_right_lat,e.top_right_lng));a.data.floor_plan_groundOverlay=new USGSOverlay(f,"data:image/png;base64,"+d,c.gmap)},function(a){console.log("error downloading floor plan")})};var l=null;a.isCanvasOverlayActive=!1,$("#input-floor-plan").change(function(b){var d=new FileReader;d.onload=function(b){var d=new Image;d.src=b.target.result,d.onload=function(){l=new CanvasOverlay(d,c.gmap),a.$apply(a.isCanvasOverlayActive=!0),a.data.floor_plan_groundOverlay&&a.data.floor_plan_groundOverlay.getMap()&&a.data.floor_plan_groundOverlay.setMap(null)}},d.readAsDataURL(b.target.files[0]),this.disabled=!0}),a.setFloorPlan=function(){if(l){null!==b.getBuildingId()&&void 0!==b.getBuildingId()||(console.log("building is undefined"),g("Something went wrong. It seems like there is no building selected"));var d={is_published:"true",buid:String(b.getBuildingId()),floor_name:String(a.newFloorNumber),description:String(a.newFloorNumber),floor_number:String(a.newFloorNumber)};a.myFloors[a.myFloorId]=d,a.myFloorId++,l.drawBoundingCanvas();var e=l.bottom_left_coords,f=l.top_right_coords;a.data.floor_plan_coords.bottom_left_lat=e.lat(),a.data.floor_plan_coords.bottom_left_lng=e.lng(),a.data.floor_plan_coords.top_right_lat=f.lat(),a.data.floor_plan_coords.top_right_lng=f.lng();var h=l.getCanvas().toDataURL("image/png");a.data.floor_plan_base64_data=h;var i=new google.maps.LatLngBounds(new google.maps.LatLng(e.lat(),e.lng()),new google.maps.LatLng(f.lat(),f.lng()));if(a.data.floor_plan_groundOverlay=new USGSOverlay(i,h,c.gmap),l.setMap(null),$("#input-floor-plan").prop("disabled",!1),a.isCanvasOverlayActive=!1,n(a.newFloorNumber))for(var j=0;j<a.xFloors.length;j++){var k=a.xFloors[j];if(!LPUtils.isNullOrUndefined(k)&&k.floor_number===String(a.newFloorNumber)){a.uploadFloorPlanBase64(a.anyService.selectedBuilding,k,a.data);break}}else a.addFloorObject(d,a.anyService.selectedBuilding,a.data)}};var m=function(a){return a=null===a?{}:JSON.parse(JSON.stringify(a)),LPUtils.isNullOrUndefined(a.buid)&&(a.buid=""),LPUtils.isNullOrUndefined(a.floor_name)&&(a.floor_name=""),LPUtils.isNullOrUndefined(a.floor_number)&&(a.floor_number=""),LPUtils.isNullOrUndefined(a.description)&&(a.description=""),LPUtils.isNullOrUndefined(a.is_published)&&(a.is_published="true"),a};a.addFloorObject=function(b,c,d){var e=m(b);if(e.owner_id=a.owner_id,!e.owner_id)return void g("Could not authorize user. Please refresh.");a.anyAPI.addFloor(e).then(function(b){b.data,a.xFloors.push(e),a.anyService.selectedFloor=a.xFloors[a.xFloors.length-1],h("Successfully added new floor"),a.uploadFloorPlanBase64(c,e,d)},function(a){var b=a.data;console.log(b.message),g("Something went wrong while adding a new floor.")})},a.removeFloorPlan=function(){a.data.floor_plan_file=null,a.data.floor_plan=null,l&&l.setMap(null),a.data.floor_plan_groundOverlay&&a.data.floor_plan_groundOverlay.setMap(null);var b=$("#input-floor-plan");b.replaceWith(b=b.clone(!0)),b.prop("disabled",!1),a.isCanvasOverlayActive=!1},a.deleteFloor=function(){var b=a.anyService.getFloor();if(LPUtils.isNullOrUndefined(b)||LPUtils.isStringBlankNullUndefined(b.floor_number)||LPUtils.isStringBlankNullUndefined(b.buid))return void g("No floor seems to be selected.");b.username=a.creds.username,b.password=a.creds.password,b.owner_id=a.owner_id,console.log(b),a.anyAPI.deleteFloor(b).then(function(c){for(var d=(c.data,a.xFloors),e=d.length,f=0;f<e;f++)if(d[f].floor_number==b.floor_number){d.splice(f,1);break}null!=a.data.floor_plan_groundOverlay&&(a.data.floor_plan_groundOverlay.setMap(null),a.data.floor_plan_groundOverlay=null),a.xFloors&&a.xFloors.length>0?a.anyService.selectedFloor=a.xFloors[0]:a.anyService.selectedFloor=void 0,h("Successfully deleted floor.")},function(a){a.data,g("Something went wrong while deleting the floor.")})};var n=function(b){for(var c=0;c<a.xFloors.length;c++){var d=a.xFloors[c];if(!LPUtils.isNullOrUndefined(d)&&d.floor_number===String(b))return!0}return!1},o=function(a){return LPUtils.isNullOrUndefined(a)?{}:JSON.parse(JSON.stringify(a))};a.uploadFloorPlanBase64=function(b,c,d){if(!LPUtils.isNullOrUndefined(l)){var e=o(d.floor_plan_coords);if(LPUtils.isNullOrUndefined(e)||LPUtils.isStringBlankNullUndefined(e.bottom_left_lat)||LPUtils.isStringBlankNullUndefined(e.bottom_left_lng)||LPUtils.isStringBlankNullUndefined(e.top_right_lat)||LPUtils.isStringBlankNullUndefined(e.top_right_lng))return console.log("error with floor coords"),void g("Something went wrong. It seems like no valid coordinates have been set up for this floor plan.");if(e.bottom_left_lat=String(e.bottom_left_lat),e.bottom_left_lng=String(e.bottom_left_lng),e.top_right_lat=String(e.top_right_lat),e.top_right_lng=String(e.top_right_lng),c.bottom_left_lat=e.bottom_left_lat,c.bottom_left_lng=e.bottom_left_lng,c.top_right_lat=e.top_right_lat,c.top_right_lng=e.top_right_lng,LPUtils.isNullOrUndefined(b))return void g("Something went wrong. It seems like there is no building selected.");if(LPUtils.isNullOrUndefined(b.buid))return void g("Something went wrong with the selected building's id.");if(e.buid=b.buid,LPUtils.isNullOrUndefined(c))return void g("Something went wrong. It seems there is no floor selected.");if(LPUtils.isNullOrUndefined(c.floor_number))return void g("Something went wrong. It seems there is no floor number associated with the selected floor.");e.floor_number=c.floor_number,e.owner_id=a.owner_id;var f=JSON.stringify(e);if(LPUtils.isNullOrUndefined(d.floor_plan_base64_data)||LPUtils.isStringEmptyNullUndefined(d.floor_plan_base64_data))return void console.log("no floor plan file");a.anyAPI.uploadFloorPlan64(f,a.data.floor_plan_base64_data).then(function(a){a.data;h("Successfully uploaded new floor plan.")},function(a){a.data;h("Successfully uploaded new floor plan.")})}},a.toggleRadioHeatmap=function(){if(e&&e.getMap())return void e.setMap(null);a.showRadioHeatmap()},a.showRadioHeatmapPoi=function(){var b={buid:a.anyService.getBuildingId(),floor:a.anyService.getFloorNumber(),coordinates_lat:a.anyService.selectedPoi.coordinates_lat,coordinates_lon:a.anyService.selectedPoi.coordinates_lon,range:"1"};b.username=a.creds.username,b.password=a.creds.password,a.anyAPI.getRadioHeatmapPoi(b).then(function(b){var c=(b.data,[]),d=b.data.radioPoints.length;if(d<=0)return void g("This floor seems not to be WiFi mapped. Download the Anyplace app from the Google Play store to map the floor.");for(;d--;){var f=b.data.radioPoints[d];c.push({location:new google.maps.LatLng(f.x,f.y),weight:1}),b.data.radioPoints.splice(d,1)}e&&e.getMap()&&e.setMap(null),e=new google.maps.visualization.HeatmapLayer({data:c}),e.setMap(a.gmapService.gmap)},function(a){a.data,g("Something went wrong while fetching radio heatmap.")})},a.showRadioHeatmap=function(){var b={buid:a.anyService.getBuildingId(),floor:a.anyService.getFloorNumber()};b.username=a.creds.username,b.password=a.creds.password,a.anyAPI.getRadioHeatmap(b).then(function(b){var c=(b.data,[]),d=b.data.radioPoints.length;if(d<=0)return void g("This floor seems not to be WiFi mapped. Download the Anyplace app from the Google Play store to map the floor.");for(;d--;){var f=b.data.radioPoints[d];c.push({location:new google.maps.LatLng(f.x,f.y),weight:1}),b.data.radioPoints.splice(d,1)}e&&e.getMap()&&e.setMap(null),e=new google.maps.visualization.HeatmapLayer({data:c}),e.setMap(a.gmapService.gmap)},function(a){a.data,g("Something went wrong while fetching radio heatmap.")})}}]),app.controller("PoiController",["$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(a,b,c,d,e){_CONNECTIONS_IS_ON=!0,_POIS_IS_ON=!0,a.anyService=d,a.anyAPI=e,a.myMarkers={},a.myMarkerId=0,a.myPaths={},a.myPathId=0,a.myPois=[],a.myPoisHashT={},a.myConnectionsHashT={},a.edgeMode=!1,a.connectPois={prev:void 0,next:void 0},a.crudTabSelected=1,a.setCrudTabSelected=function(b){a.crudTabSelected=b},a.isCrudTabSelected=function(b){return a.crudTabSelected===b},a.orderByName=function(a){return a.name},a.$on("loggedOff",function(b,c){a.clearConnectionsOnMap(),a.clearPoisOnMap(),a.myPaths={},a.myPathId=0,a.myMarkers={},a.myMarkerId=0,a.myPois=[],a.myPoisHashT={},a.myConnectionsHashT={},a.anyService.setAllPois(a.myPoisHashT),a.anyService.setAllConnection(a.myConnectionsHashT),a.edgeMode=!1,a.connectPois={prev:void 0,next:void 0}}),a.$watch("anyService.selectedBuilding",function(b,c){a.poisTypes=["Disabled Toilets","Elevator","Entrance","Fire Extinguisher","First Aid/AED","Kitchen","Office","Ramp","Room","Security/Guard","Stair","Toilets","Other"],a.poicategories=[{poicat:"Disabled Toilets",poicatPlaceholder:"name",id:"type1",disenable:"false"},{poicat:"Elevator",poicatPlaceholder:"name",id:"type2",disenable:"true"},{poicat:"Entrance",poicatPlaceholder:"name",id:"type3",disenable:"true"},{poicat:"Fire Extinguisher",poicatPlaceholder:"name",id:"type4",disenable:"false"},{poicat:"First Aid/AED",poicatPlaceholder:"name",id:"type5",disenable:"false"},{poicat:"Kitchen",poicatPlaceholder:"name",id:"type6",disenable:"false"},{poicat:"Office",poicatPlaceholder:"name",id:"type7",disenable:"false"},{poicat:"Ramp",poicatPlaceholder:"name",id:"type8",disenable:"false"},{poicat:"Room",poicatPlaceholder:"name",id:"type9",disenable:"false"},{poicat:"Security/Guard",poicatPlaceholder:"name",id:"type10",disenable:"false"},{poicat:"Stair",poicatPlaceholder:"name",id:"type11",disenable:"true"},{poicat:"Toilets",poicatPlaceholder:"name",id:"type12",disenable:"false"},{poicat:"Other",poicatPlaceholder:"name",id:"type13",disenable:"false"}]}),a.$watch("anyService.selectedFloor",function(b,c){void 0===b||null===b||_.isEqual(b,c)?a.anyService.selectedPoi=void 0:a.fetchAllPoisForFloor(b)}),a.$watch("anyService.selectedPoi",function(b,d){if(b&&i(b)&&b&&(c.gmap.panTo(i(b)),b.puid)){var e=a.myPoisHashT[b.puid].marker;e&&e.infowindow&&e.tpl2&&(e.infowindow.setContent(e.tpl2[0]),e.infowindow.open(c.gmap,e)),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastPoi",b.puid)}}),a.add=function(){""!=a.poicategories[a.poicategories.length-1].poicat?a.poicategories.push({poicat:"",poicatPlaceholder:"name",disenable:"false"}):j("Complete the last input to continue!")},a.deletetype=function(b){for(var c=0;c<a.poicategories.length;c++)if(a.poicategories[c].id==b){a.poicategories[c].id="",$("#".id).remove();break}},a.addcategory=function(){function b(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var c=document.getElementById("poistype"),d='"poistype":"'+c.value+'"',e=(b()+b()+"-"+b()+"-4"+b().substr(0,3)+"-"+b()+"-"+b()+b()+b()).toLowerCase(),f=new Date,g="poistypeid_"+e+"_"+f.getTime();g='"poistypeid":"'+g+'"';var h=a.poicategories.length;if(0==h)return void j("No categories added.");for(var i='"types":[',l=h-1;l>0;l--)""!=a.poicategories[l].poicat&&(i=i+'"'+a.poicategories[l].poicat+'",');i=i+'"'+a.poicategories[0].poicat+'"]';var m="{"+d+","+g+","+i+',"owner_id":"'+a.owner_id+'","access_token":"'+a.gAuth.access_token+'"}';a.anyAPI.addCategory(m).then(function(a){a.data,k("Successfully added category.")},function(a){var b=a.data;j("Something went wrong while adding the category. "+b.message)})},a.fetchAllPoisTypes=function(b){var c=a.anyService.jsonReq;if(c.username=a.creds.username,c.password=a.creds.password,c.owner_id=a.owner_id,c.access_token=a.gAuth.access_token,c.poistypeid=b,!c.owner_id)return void j("Could nor authorize user. Please refresh.");a.anyAPI.retrievePoisTypes(c).then(function(c){for(var d=c.data,e=d.poistypes,f=e.length,g=f-1;g>=0;g--)if(e[g].poistypeid==b){var h=e[g].types;break}for(var f=h.length,g=f-1;g>=0;g--)a.poisTypes[g]=h[g]},function(a){a.data,j("Something went wrong while fetching POIs types")})},a.onInfoWindowKeyDown=function(b){if(27==b.keyCode&&a.anyService.selectedPoi){var c=a.anyService.selectedPoi;a.myPoisHashT[c.puid]&&a.myPoisHashT[c.puid].marker&&a.myPoisHashT[c.puid].marker.infowindow&&(a.myPoisHashT[c.puid].marker.infowindow.setMap(null),a.anyService.setAllPois(a.myPoisHashT))}},a.clearPoisOnMap=function(){for(var b=0;b<a.myPois.length;b++){var c=a.myPois[b];c&&a.myPoisHashT[c.puid]&&a.myPoisHashT[c.puid].marker&&(a.myPoisHashT[c.puid].marker.setMap(null),delete a.myPoisHashT[c.puid])}a.myPoisHashT={},a.anyService.setAllPois(a.myPoisHashT)},a.clearConnectionsOnMap=function(){if(a.myConnectionsHashT){for(var b in a.myConnectionsHashT)b&&a.myConnectionsHashT.hasOwnProperty(b)&&a.myConnectionsHashT[b]&&a.myConnectionsHashT[b].polyLine&&(a.myConnectionsHashT[b].polyLine.setMap(null),delete a.myConnectionsHashT[b]);a.myConnectionsHashT={}}a.anyService.setAllConnection(a.myConnectionsHashT)},a.fetchConnections=function(){var b,c,d=a.anyService.jsonReq,e=a.anyService.getBuilding();if(LPUtils.isNullOrUndefined(e))return void j("No building has been selected!");if(LPUtils.isNullOrUndefined(e.buid))return void j("No valid building has been selected!");b=a.anyService.getBuildingId();var f=a.anyService.getFloor();if(LPUtils.isNullOrUndefined(f))return void j("No floor has been selected!");if(LPUtils.isNullOrUndefined(f.floor_number))return void j("No valid floor has been selected!");if(c=a.anyService.getFloorNumber(),d.buid=b,d.floor_number=c,(LPUtils.isNullOrUndefined(a.myPois)||LPUtils.isNullOrUndefined(a.myPoisHashT))&&j("Please load the POIs of this floor first."),0!=a.myPois.length){var g=d;a.anyAPI.retrieveConnectionsByBuildingFloor(g).then(function(b){for(var c=b.data,d=c.connections,e={},f=d.length,g=0;g<f;g++)e[d[g].cuid]=d[g];a.myConnectionsHashT=e,a.anyService.setAllConnection(a.myConnectionsHashT),a.drawConnectionsOnMap()},function(a){a.data;j("Something went wrong while loading the POI connections")})}},a.drawConnectionsOnMap=function(){for(var b in a.myConnectionsHashT)if(a.myConnectionsHashT.hasOwnProperty(b)){var d=a.myConnectionsHashT[b];if(!(d&&d.pois_a&&d.pois_b&&a.myPoisHashT[d.pois_a]&&a.myPoisHashT[d.pois_b]&&a.myPoisHashT[d.pois_a].model&&a.myPoisHashT[d.pois_b].model))continue;var e=[new google.maps.LatLng(a.myPoisHashT[d.pois_a].model.coordinates_lat,a.myPoisHashT[d.pois_a].model.coordinates_lon),new google.maps.LatLng(a.myPoisHashT[d.pois_b].model.coordinates_lat,a.myPoisHashT[d.pois_b].model.coordinates_lon)],f=new google.maps.Polyline({path:e,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:4});_CONNECTIONS_IS_ON&&f.setMap(c.gmap),f.model=d,a.myConnectionsHashT[b].polyLine=f,a.anyService.setAllConnection(a.myConnectionsHashT),google.maps.event.addListener(f,"click",function(){a.$apply(s(this)),a.anyService.setAllConnection(a.myConnectionsHashT)})}};var f="build/images/edge-connector-icon.png",g="build/images/any-poi-icon.png",h="build/images/poi-icon.png",i=function(a){if(a&&a.coordinates_lat&&a.coordinates_lon)return{lat:parseFloat(a.coordinates_lat),lng:parseFloat(a.coordinates_lon)}},j=function(b){a.anyService.addAlert("danger",b)},k=function(b){a.anyService.addAlert("success",b)},l=function(b){a.anyService.addAlert("warning",b)},m=function(b){var c=.001,d=b.lat(),e=b.lng(),f=a.anyService.getFloor();if(LPUtils.isNullOrUndefined(f))return j("No selected floor found."),!1;var g=f.top_right_lat,h=f.top_right_lng,i=f.bottom_left_lat,k=f.bottom_left_lng;return g&&h&&i&&k?d<=parseFloat(g)+c&&e<=parseFloat(h)+c&&d>=parseFloat(i)-c&&e>=parseFloat(k)-c:(j("Floor coordinates not found."),!1)};a.drawPoisOnMap=function(){var d=new google.maps.InfoWindow({content:"-",maxWidth:500}),e=void 0,h=-1;"undefined"==typeof Storage||!localStorage||LPUtils.isNullOrUndefined(localStorage.getItem("lastBuilding"))||LPUtils.isNullOrUndefined(localStorage.getItem("lastFloor"))||LPUtils.isNullOrUndefined(localStorage.getItem("lastPoi"))||(e=localStorage.getItem("lastPoi"));for(var k=0;k<a.myPois.length;k++){a.myPois[k].pois_type2=a.myPois[k].pois_type;var l=a.myPois[k];e&&l.puid===e&&(h=k);var m,r="-";if(l.pois_type2=l.pois_type,"None"==l.pois_type)m=new google.maps.Marker({position:i(l),draggable:!0,icon:new google.maps.MarkerImage(f,null,null,null,new google.maps.Size(21,21))}),_POIS_IS_ON&&m.setMap(c.gmap),r='<div class="infowindow-scroll-fix" style="text-align: center; width:170px"><fieldset class="form-group" style="display: inline-block; width: 73%;"><button type="submit" class="btn btn-success add-any-button" ng-click="updatePoi(\''+l.puid+'\')"><span class="glyphicon glyphicon-pencil"></span> Update</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi(\''+l.puid+'\')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div>';else{var t=g,u=new google.maps.Size(21,32);m=new google.maps.Marker({position:i(l),draggable:!0,icon:new google.maps.MarkerImage(t,null,null,null,u)}),_POIS_IS_ON&&m.setMap(c.gmap),r='<div class="infowindow-scroll-fix" ng-keydown="onInfoWindowKeyDown($event)"><form name="poiForm"><fieldset class="form-group"><textarea ng-model="myPois['+k+'].name" id="poi-name" type="text" class="form-control" placeholder="poi name" tabindex="1" autofocus></textarea></fieldset><fieldset class="form-group"><textarea ng-model="myPois['+k+'].description" id="poi-description" type="text" class="form-control" placeholder="poi description" tabindex="5"></textarea></fieldset><fieldset class="form-group"><select ng-model="myPois['+k+'].pois_type" class="form-control" ng-options="type for type in poisTypes" title="POI Types" tabindex="2"><option value="">Select POI Type</option></select></fieldset class="form-group"><fieldset class="form-group">Or enter your own type:<input ng-model="myPois['+k+'].pois_type2" id="poi-pois_type2" type="text" class="form-control" placeholder="POI Type" tabindex="2"></fieldset><fieldset class="form-group"><input ng-model="myPois['+k+'].is_building_entrance" id="poi-entrance" type="checkbox" tabindex="4"><span> is building entrance?</span></fieldset><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="updatePoi(\''+l.puid+'\')" tabindex="3"><span class="glyphicon glyphicon-pencil"></span> Update</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi(\''+l.puid+'\')" tabindex="6"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form></div>'}var v=b(r)(a);m.tpl2=v,m.model=l,m.infowindow=d,a.myPoisHashT[l.puid].marker=m,a.anyService.setAllPois(a.myPoisHashT),google.maps.event.addListener(m,"click",function(){if(a.edgeMode)if(a.connectPois.prev){if(a.connectPois.prev==this)return a.connectPois.prev=void 0,void("None"===this.model.pois_type?this.setIcon(o()):this.setIcon(q()));"None"===a.connectPois.prev.model.pois_type?a.connectPois.prev.setIcon(o()):a.connectPois.prev.setIcon(q());var b=new google.maps.Polyline({path:[this.position,a.connectPois.prev.position],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.5,strokeWeight:4});b.setMap(c.gmap);var e=a.connectPois.prev.model,f=this.model;if(!e||!f||!e.puid||!f.puid||!e.buid||!f.buid||LPUtils.isNullOrUndefined(e.floor_number)||LPUtils.isNullOrUndefined(f.floor_number))return void j("One or both of the POIs attempted to be connected seem to be be malformed. Please refresh.");var g={username:a.creds.username,password:a.creds.password,owner_id:a.owner_id,pois_a:e.puid,floor_a:e.floor_number,buid_a:e.buid,buid:e.buid,pois_b:f.puid,floor_b:f.floor_number,buid_b:f.buid,is_published:"true",edge_type:"hallway"};b.model=g;var h=a.anyAPI.addConnection(g);h.then(function(c){var d=c.data,e=d.cuid;b.model.cuid=e;var f=b.model;f.polyLine=b,a.myConnectionsHashT[e]=f,a.anyService.setAllConnection(a.myConnectionsHashT),b.setOptions({strokeColor:"#0000FF",strokeOpacity:.5}),google.maps.event.addListener(b,"click",function(){a.$apply(s(this))})},function(a){a.data;j("Something went wrong while attempting to connect the two POIs."),b.setMap(null)}),a.connectPois.prev=void 0}else a.connectPois.prev=this,"None"===this.model.pois_type?this.setIcon(n()):this.setIcon(p());else{d.setContent(this.tpl2[0]),d.open(c.gmap,this);var i=this;a.$apply(function(){i.model&&i.model.puid&&(a.anyService.selectedPoi=i.model)})}}),google.maps.event.addListener(m,"dragend",function(b){this.model&&this.model.puid&&a.updatePoiPosition(this)})}h>=0&&(a.anyService.selectedPoi=a.myPois[h]),a.fetchConnections()};var n=function(){return new google.maps.MarkerImage(f,null,null,null,new google.maps.Size(41,41))},o=function(){return new google.maps.MarkerImage(f,null,null,null,new google.maps.Size(21,21))},p=function(){return new google.maps.MarkerImage(g,null,null,null,new google.maps.Size(31,48))},q=function(){return new google.maps.MarkerImage(g,null,null,null,new google.maps.Size(21,32))},r=function(a){return null===a&&(a={}),LPUtils.isNullOrUndefined(a.buid)&&(a.buid=""),LPUtils.isNullOrUndefined(a.is_published)&&(a.is_published=!1),LPUtils.isNullOrUndefined(a.edge_type)&&(a.edge_type=""),LPUtils.isNullOrUndefined(a.pois_a)&&(a.pois_a=""),LPUtils.isNullOrUndefined(a.pois_b)&&(a.pois_b=""),LPUtils.isNullOrUndefined(a.floor_a)&&(a.floor_a=""),LPUtils.isNullOrUndefined(a.floor_b)&&(a.floor_b=""),LPUtils.isNullOrUndefined(a.buid_a)&&(a.buid_a=""),LPUtils.isNullOrUndefined(a.buid_b)&&(a.buid_b=""),a},s=function(b){if(!a.edgeMode)return void j('Enable "Edge Mode" so you can delete connections by clicking on them.');if(!b||!b.model||!b.model.cuid)return void j("No valid connection selected.");var d=b.model,e=b.model.cuid;if(!a.myConnectionsHashT[e])return void j("The connection attempted to delete does not exist in the system.");var f=r(d);if(f.username=a.creds.username,f.password=a.creds.password,f.owner_id=a.owner_id,LPUtils.isNullOrUndefined(f.pois_a)||LPUtils.isStringBlankNullUndefined(f.pois_a))return void j("No valid connection has been selected. Missing POI A.");if(LPUtils.isNullOrUndefined(f.pois_b)||LPUtils.isStringBlankNullUndefined(f.pois_b))return void j("No valid connection has been selected. Missing POI B.");b.setMap(null);var g=b.model.polyLine;delete b.model.polyLine,a.anyAPI.deleteConnection(f).then(function(b){b.data,delete a.myConnectionsHashT[e],a.anyService.setAllConnection(a.myConnectionsHashT)},function(a){a.data,b.setMap(c.gmap),b.model.polyLine=g,j("Something went wrong. Connection could not be deleted.")})};a.fetchAllPoisForFloor=function(b){var c=d.jsonReq;c.buid=d.getBuildingId(),c.floor_number=d.getFloorNumber(),e.retrievePoisByBuildingFloor(c).then(function(b){var c=b.data;a.clearPoisOnMap(),a.clearConnectionsOnMap(),a.myPois=c.pois;for(var d=a.myPois.length,e=d-1;e>=0;e--){var f=a.myPois[e].puid;"true"==a.myPois[e].is_building_entrance?a.myPois[e].is_building_entrance=!0:a.myPois[e].is_building_entrance=!1,a.myPois[e].pois_type2=a.myPois[e].pois_type,a.myPoisHashT[f]={},a.myPoisHashT[f].model=a.myPois[e],a.anyService.setAllPois(a.myPoisHashT)}a.drawPoisOnMap()},function(a){a.data,j("Something went wrong while fetching POIs")})};var t=new google.maps.OverlayView;t.draw=function(){},t.setMap(c.gmap),a.addPoi=function(b){if(a.myMarkers[b]&&a.myMarkers[b].marker){0!=a.myMarkers[b].model.pois_type2.localeCompare("")&&(a.myMarkers[b].model.pois_type=a.myMarkers[b].model.pois_type2);var d=a.myMarkers[b].model;if(d.owner_id=a.owner_id,d.coordinates_lat=String(a.myMarkers[b].marker.position.lat()),d.coordinates_lon=String(a.myMarkers[b].marker.position.lng()),d.is_building_entrance=String(d.is_building_entrance),void 0===d.coordinates_lat||null===d.coordinates_lat)return void j("POI has invalid latitude format");if(void 0===d.coordinates_lon||null===d.coordinates_lon)return void j("POI has invalid longitude format");if(!(d.owner_id&&d.name&&d.buid&&d.pois_type)||LPUtils.isNullOrUndefined(d.is_building_entrance)||LPUtils.isNullOrUndefined(d.is_published)||LPUtils.isNullOrUndefined(d.is_door)||LPUtils.isNullOrUndefined(d.floor_name)||LPUtils.isNullOrUndefined(d.floor_number))j("Cannot add new POI. Some required fields are missing.");else{"true"==d.is_building_entrance?d.is_building_entrance="true":d.is_building_entrance="false";var e=d;a.anyAPI.addPois(e).then(function(e){var f=e.data;d.puid=f.puid,"true"==d.is_building_entrance?d.is_building_entrance=!0:d.is_building_entrance=!1,a.myPois.push(d),a.anyService.selectedPoi=a.myPois[a.myPois.length-1],a.myPoisHashT[d.puid]={model:d,marker:a.myMarkers[b].marker},a.anyService.setAllPois(a.myPoisHashT),a.myMarkers[b].model=d,a.myMarkers[b].infowindow&&(a.myMarkers[b].infowindow.close(),a.myMarkers[b].infowindow.setContent(a.myMarkers[b].marker.tpl2[0])),a.myMarkers[b].marker.model=d,"None"==a.myMarkers[b].marker.model.pois_type?a.myMarkers[b].marker.setIcon(o()):a.myMarkers[b].marker.setIcon(q()),google.maps.event.clearListeners(a.myMarkers[b].marker,"click");var g=a.myMarkers[b].infowindow;google.maps.event.addListener(a.myMarkers[b].marker,"click",function(){if(a.edgeMode)if(a.connectPois.prev){if(a.connectPois.prev==this)return a.connectPois.prev=void 0,void("None"===this.model.pois_type?this.setIcon(o()):this.setIcon(q()));"None"===a.connectPois.prev.model.pois_type?a.connectPois.prev.setIcon(o()):a.connectPois.prev.setIcon(q());var b=new google.maps.Polyline({path:[this.position,a.connectPois.prev.position],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.5,strokeWeight:4});b.setMap(c.gmap);var d=a.connectPois.prev.model,e=this.model;if(!d||!e||!d.puid||!e.puid||!d.buid||!e.buid||LPUtils.isNullOrUndefined(d.floor_number)||LPUtils.isNullOrUndefined(e.floor_number))return void j("One or both of the POIs attempted to be connected seem to be be malformed. Please refresh.");var f={username:a.creds.username,password:a.creds.password,owner_id:a.owner_id,pois_a:d.puid,floor_a:d.floor_number,buid_a:d.buid,buid:d.buid,pois_b:e.puid,floor_b:e.floor_number,buid_b:e.buid,is_published:"true",edge_type:"hallway"};b.model=f;var h=a.anyAPI.addConnection(f);h.then(function(c){var d=c.data,e=d.cuid;b.model.cuid=e;var f=b.model;f.polyLine=b,a.myConnectionsHashT[e]=f,a.anyService.setAllConnection(a.myConnectionsHashT),b.setOptions({strokeColor:"#0000FF",strokeOpacity:.5}),google.maps.event.addListener(b,"click",function(){a.$apply(s(this))})},function(a){a.data;j("Something went wrong while attempting to connect the two POIs."),b.setMap(null)}),a.connectPois.prev=void 0}else a.connectPois.prev=this,"None"===this.model.pois_type?this.setIcon(n()):this.setIcon(p());else{g.setContent(this.tpl2[0]),g.open(c.gmap,this);var i=this;a.$apply(function(){i.model&&i.model.puid&&(a.anyService.selectedPoi=i.model)})}}),google.maps.event.addListener(a.myMarkers[b].marker,"dragend",function(b){this.model&&this.model.puid&&a.updatePoiPosition(this)})},function(a){a.data;j("Something went wrong while adding the new POI.")})}}},a.deletePoi=function(b){var c=a.myPoisHashT[b];if(!c||!c.model||!c.model.puid){if(!(a.myPoisHashT&&a.myMarkers&&a.myMarkers[b]&&a.myMarkers[b].model&&a.myPoisHashT[a.myMarkers[b].model.puid]))return void j("No valid POI selected to be deleted.");if(!(c=a.myPoisHashT[a.myMarkers[b].model.puid])||!c.model||!c.model.puid)return void j("No valid POI selected to be deleted.")}var d,e=a.myConnectionsHashT;for(var f in e)if(e.hasOwnProperty(f)&&(d=e[f],d.pois_a==c.model.puid||d.pois_b==c.model.puid))return void j("Please delete all the connections attached to this POI first.");var g=c.model;g.username=a.creds.username,g.password=a.creds.password,g.owner_id=a.owner_id;var h=g.puid;!0===g.is_building_entrance||"true"===g.is_building_entrance?g.is_building_entrance="true":g.is_building_entrance="false",a.anyAPI.deletePois(g).then(function(b){b.data,"true"===g.is_building_entrance?g.is_building_entrance=!0:g.is_building_entrance=!1;for(var c=a.myPois,d=c.length,e=0;e<d;e++)if(c[e].puid==h){c.splice(e,1),a.myPoisHashT[h]&&a.myPoisHashT[h].marker&&a.myPoisHashT[h].marker.setMap(null),delete a.myPoisHashT[h],a.anyService.setAllPois(a.myPoisHashT);break}k("Successfully deleted POI.")},function(b){for(var c=(b.data,a.myPois),d=c.length,e=0;e<d;e++)if(c[e].puid==h){c.splice(e,1),a.myPoisHashT[h]&&a.myPoisHashT[h].marker&&a.myPoisHashT[h].marker.setMap(null),delete a.myPoisHashT[h],a.anyService.setAllPois(a.myPoisHashT);break}j("Something went wrong while deleting POI.")})},a.updatePoi=function(b){var c=a.myPoisHashT[b];if(!c||!c.model||!c.model.puid){
if(!(a.myPoisHashT&&a.myMarkers&&a.myMarkers[b]&&a.myMarkers[b].model&&a.myPoisHashT[a.myMarkers[b].model.puid]))return void j("No valid POI selected to be updated.");if(!(c=a.myPoisHashT[a.myMarkers[b].model.puid])||!c.model||!c.model.puid)return void j("No valid POI selected to be updated.")}0!=c.model.pois_type2.localeCompare("")&&(c.model.pois_type=c.model.pois_type2);var d=c.model;d.username=a.creds.username,d.password=a.creds.password,d.owner_id=a.owner_id;var e=c.marker;if(e){var f=e.position;f&&f.lat()&&f.lng()&&(d.coordinates_lat=String(f.lat()),d.coordinates_lon=String(f.lng()))}d.is_building_entrance?d.is_building_entrance="true":d.is_building_entrance="false",a.anyAPI.updatePois(d).then(function(b){b.data,e&&e.infowindow.setMap(null),"true"==d.is_building_entrance?d.is_building_entrance=!0:d.is_building_entrance=!1;for(var c in a.myConnectionsHashT)if(a.myConnectionsHashT.hasOwnProperty(c)&&(a.myConnectionsHashT[c].pois_a==d.puid||a.myConnectionsHashT[c].pois_b==d.puid)){var f=a.myConnectionsHashT[c].pois_a,g=a.myConnectionsHashT[c].pois_b,h=[new google.maps.LatLng(a.myPoisHashT[f].model.coordinates_lat,a.myPoisHashT[f].model.coordinates_lon),new google.maps.LatLng(a.myPoisHashT[g].model.coordinates_lat,a.myPoisHashT[g].model.coordinates_lon)];a.myConnectionsHashT[c].polyLine.setPath(h),a.anyService.setAllConnection(a.myConnectionsHashT),a.anyService.setAllPois(a.myPoisHashT)}},function(a){a.data,j("Something went wrong while updating POI. Please refresh and try again.")})},a.updatePoiPosition=function(b){var c;b&&b.model&&(c=b.model),c.username=a.creds.username,c.password=a.creds.password,c.owner_id=a.owner_id;var d=b.position;d&&d.lat()&&d.lng()&&(c.coordinates_lat=String(d.lat()),c.coordinates_lon=String(d.lng())),c.is_building_entrance?c.is_building_entrance="true":c.is_building_entrance="false",a.anyAPI.updatePois(c).then(function(d){d.data,"true"==c.is_building_entrance||!0===c.is_building_entrance?c.is_building_entrance=!0:c.is_building_entrance=!1;for(var e in a.myConnectionsHashT)if(a.myConnectionsHashT.hasOwnProperty(e)&&(a.myConnectionsHashT[e].pois_a==b.model.puid||a.myConnectionsHashT[e].pois_b==b.model.puid)){var f=a.myConnectionsHashT[e].pois_a,g=a.myConnectionsHashT[e].pois_b,h=[new google.maps.LatLng(a.myPoisHashT[f].model.coordinates_lat,a.myPoisHashT[f].model.coordinates_lon),new google.maps.LatLng(a.myPoisHashT[g].model.coordinates_lat,a.myPoisHashT[g].model.coordinates_lon)];a.myConnectionsHashT[e].polyLine.setPath(h),a.anyService.setAllConnection(a.myConnectionsHashT),a.anyService.setAllPois(a.myPoisHashT)}},function(a){a.data,j("Something went wrong while moving POI.")})},a.removeMarker=function(b){a.myMarkers[b]?(a.myMarkers[b].marker.setMap(null),delete a.myMarkers[b]):j("It seems that the marker to be deleted does not exist.")},a.placeMarker=function(e,f,g,h){var i=new google.maps.Marker({position:e,map:c.gmap,icon:new google.maps.MarkerImage(f,null,null,null,g),draggable:!0});if(null===d.getBuildingId()||void 0===d.getBuildingId())return void j("It seems there is no building selected. Please refresh.");var k=new google.maps.InfoWindow({content:"-",maxWidth:500});a.$apply(function(){i.myId=a.myMarkerId,a.myMarkers[i.myId]={},a.myMarkers[i.myId].model={buid:d.getBuildingId(),floor_number:d.getFloorNumber(),floor_name:d.getFloorName(),is_door:"false",is_building_entrance:"false",is_published:"true",description:"connector"===h?"Connector":"",name:"connector"===h?"Connector":"",pois_type:"connector"===h?"None":"",pois_type2:"connector"===h?"None":"",url:"-",image:"url_to_pois_image"},a.myMarkers[i.myId].marker=i,a.myMarkers[i.myId].model.pois_type2=a.myMarkers[i.myId].model.pois_type,a.myMarkerId++});var m='<div class="infowindow-scroll-fix" ng-keydown="onInfoWindowKeyDown($event)"><form name="poiForm"><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.name" id="poi-name" type="text" class="form-control" placeholder="poi name" tabindex="1" autofocus/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+i.myId+'].model.description" id="poi-description" type="text" class="form-control" placeholder="poi description" tabindex="5"></textarea></fieldset><fieldset class="form-group"><select ng-model="myMarkers['+i.myId+'].model.pois_type" class="form-control" ng-options="type for type in poisTypes" title="POI Types" tabindex="2"><option value="">Select POI Type</option></select></fieldset class="form-group"><fieldset class="form-group">Or ender your one type name:<input ng-model="myMarkers['+i.myId+'].model.pois_type2" id="poi-pois_type2" type="text" class="form-control" placeholder="POI Type" tabindex="2"></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.is_building_entrance" id="poi-entrance" type="checkbox" tabindex="4"><span> is building entrance?</span></fieldset><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addPoi('+i.myId+')" tabindex="3"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempPoi('+i.myId+')" tabindex="6"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form></div>',n='<div class="infowindow-scroll-fix" ng-keydown="onInfoWindowKeyDown($event)"><form name="poiForm"><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.name" id="poi-name" type="text" class="form-control" placeholder="poi name" tabindex="1" autofocus/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+i.myId+'].model.description" id="poi-description" type="text" class="form-control" placeholder="poi description" tabindex="5"></textarea></fieldset><fieldset class="form-group"><select ng-model="myMarkers['+i.myId+'].model.pois_type" class="form-control" ng-options="type for type in poisTypes" title="POI Types" tabindex="2"><option value="">Select POI Type</option></select></fieldset class="form-group"><fieldset class="form-group">Or ender your one type name:<input ng-model="myMarkers['+i.myId+'].model.pois_type" id="poi-pois_type2" type="text" class="form-control" placeholder="POI Type" tabindex="2"></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.is_building_entrance" id="poi-entrance" type="checkbox" tabindex="4"><span> is building entrance?</span></fieldset><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="updatePoi('+i.myId+')" tabindex="3"><span class="glyphicon glyphicon-pencil"></span> Update</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi('+i.myId+')" tabindex="6"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form></div>',o='<div class="infowindow-scroll-fix" style="text-align: center; width:170px"><div style="margin-bottom: 5px">POI Connector</div><fieldset class="form-group" style="display: inline-block; width: 73%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addPoi('+i.myId+')"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempPoi('+i.myId+')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div>',p='<div class="infowindow-scroll-fix" style="text-align: center; width:170px"><div style="margin-bottom: 5px">POI Connector</div><fieldset class="form-group"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi('+i.myId+')"><span class="glyphicon glyphicon-remove"></span> Remove</button></fieldset></div>';if("poi"==h){var q=b(m)(a);i.tpl2=b(n)(a),k.setContent(q[0]),k.open(c.gmap,i)}else if("connector"==h){var r=b(o)(a);i.tpl2=b(p)(a),k.setContent(r[0]),a.addPoi(i.myId)}a.$apply(a.myMarkers[i.myId].infowindow=k),google.maps.event.addListener(i,"click",function(){a.edgeMode&&a.$apply(l("Only submitted objects can be connected together.")),k.open(c.gmap,i)})},a.deleteTempPoi=function(b){if(!a.myMarkers||!a.myMarkers[b].marker)return void j("No valid POI marker to delete found.");a.myMarkers[b].marker.setMap(null)},a.toggleEdgeMode=function(){a.edgeMode=!a.edgeMode,a.edgeMode||(a.connectPois.prev=void 0)},$("#draggable-poi").draggable({helper:"clone",stop:function(b){var c=new google.maps.Point(b.pageX,b.pageY),d=t.getProjection().fromContainerPixelToLatLng(c);if(!m(d))return void a.$apply(l("The marker was placed too far away from the selected building."));a.placeMarker(d,h,new google.maps.Size(21,32),"poi")}}),$("#draggable-connector").draggable({helper:"clone",stop:function(b){var c=new google.maps.Point(b.pageX,b.pageY),d=t.getProjection().fromContainerPixelToLatLng(c);if(!m(d))return void a.$apply(l("The marker was placed too far away from the selected building."));a.placeMarker(d,f,new google.maps.Size(21,21),"connector")}})}]),app.controller("SelectFloorController",["$scope","AnyplaceService","GMapService","AnyplaceAPIService",function(a,b,c,d){a.anyService=b,a.anyAPI=d,a.gmapService=c,a.xFloors=[],a.$watch("anyService.availableFloors",function(b,c){b&&(a.xFloors=[],a.xFloors=a.anyService.availableFloors)});var e=function(b){a.anyService.addAlert("danger",b)};a.orderByFloorNo=function(a){return!a||LPUtils.isNullOrUndefined(a.floor_number)?0:parseInt(a.floor_number)},a.floorUp=function(){changedfloor=!0;for(var b,c=0;c<a.xFloors.length;c++)if(b=c+1,a.xFloors[c].floor_number===a.anyService.selectedFloor.floor_number)return b<a.xFloors.length?void(a.anyService.selectedFloor=a.xFloors[b]):void 0;e("Floor not found.")},a.floorDown=function(){changedfloor=!0;for(var b,c=0;c<a.xFloors.length;c++)if(b=c-1,a.xFloors[c].floor_number===a.anyService.selectedFloor.floor_number)return b>=0?void(a.anyService.selectedFloor=a.xFloors[b]):void 0;e("Floor not found.")}}]);var heatMap=[],APmap=[],heatmap,heatmapFingerprints=[],userTimeData=[],fingerPrintsMap=[],heatmapAcc,connectionsMap={},POIsMap={},drawingManager,_HEATMAP_RSS_IS_ON=!1,_APs_IS_ON=!1,_FINGERPRINTS_IS_ON=!1,_DELETE_FINGERPRINTS_IS_ON=!1,_HEATMAP_F_IS_ON=!1,_CONNECTIONS_IS_ON=!1,_POIS_IS_ON=!1,changedfloor=!1,colorBarGreenClicked=!1,colorBarYellowClicked=!1,colorBarOrangeClicked=!1,colorBarPurpleClicked=!1,colorBarRedClicked=!1,levelOfZoom=1;app.controller("WiFiController",["$cookieStore","$scope","AnyplaceService","GMapService","AnyplaceAPIService",function(a,b,c,d,e){function f(){var c=0;if(void 0!==heatMap[c]&&null!==heatMap[c]){for(var d=heatMap.length;d--;)heatMap[d].rectangle.setMap(null),heatMap[d]=null;heatMap=[],document.getElementById("radioHeatmapRSS-mode").classList.remove("draggable-border-green"),_HEATMAP_RSS_IS_ON=!1,j("g",!1),j("y",!1),j("o",!1),j("p",!1),j("r",!1),b.radioHeatmapRSSMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","NO"),b.anyService.radioHeatmapRSSMode=!1,b.radioHeatmapRSSHasGreen=!1,b.radioHeatmapRSSHasYellow=!1,b.radioHeatmapRSSHasOrange=!1,b.radioHeatmapRSSHasPurple=!1,b.radioHeatmapRSSHasRed=!1,a.put("RSSClicked","NO")}}function g(){var a=0;if(void 0!==fingerPrintsMap[a]&&null!==fingerPrintsMap[a]){for(var b=fingerPrintsMap.length;b--;)fingerPrintsMap[b].setMap(null),fingerPrintsMap[b]=null;fingerPrintsMap=[],_FINGERPRINTS_IS_ON=!1,document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green")}if(heatmap&&heatmap.getMap()){heatmap.setMap(null),_FINGERPRINTS_IS_ON=!1,document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),_HEATMAP_F_IS_ON=!1;for(var b=heatmapFingerprints.length;b--;)heatmapFingerprints[b]=null;heatmapFingerprints=[]}}function h(){b.fingerPrintsMode&&(b.fingerPrintsTimeMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"),b.anyService.fingerPrintsTimeMode=!0,b.fingerPrintsMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","YES")),b.radioHeatmapRSSMode&&(b.radioHeatmapRSSTimeMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"),b.radioHeatmapRSSMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","YES"),b.anyService.radioHeatmapRSSTimeMode=!0,b.anyService.radioHeatmapRSSMode=!0),document.getElementById("fingerPrints-time-mode").classList.add("draggable-border-green")}function j(a,b){"g"===a?(colorBarGreenClicked=b,b?document.getElementById("greenSquares").classList.add("faded"):document.getElementById("greenSquares").classList.remove("faded")):"y"===a?(colorBarYellowClicked=b,b?document.getElementById("yellowSquares").classList.add("faded"):document.getElementById("yellowSquares").classList.remove("faded")):"o"===a?(colorBarOrangeClicked=b,b?document.getElementById("orangeSquares").classList.add("faded"):document.getElementById("orangeSquares").classList.remove("faded")):"p"===a?(colorBarPurpleClicked=b,b?document.getElementById("purpleSquares").classList.add("faded"):document.getElementById("purpleSquares").classList.remove("faded")):(colorBarRedClicked=b,b?document.getElementById("redSquares").classList.add("faded"):document.getElementById("redSquares").classList.remove("faded"))}function k(a){return"g"===a?colorBarGreenClicked:"y"===a?colorBarYellowClicked:"o"===a?colorBarOrangeClicked:"p"===a?colorBarPurpleClicked:colorBarRedClicked}function l(a){function c(a){d3.select(this).call(a)}function d(){r.each(c),d3.select("#active").text(j(l.value()))}function e(a){return new Date(a/1e3*1e3)}function i(){function a(a){function b(a){for(var b,d=[],e=-1,f=a.length;++e<f;)b=a[e],d.push("M",c(b.key),",",g,"V",m(b.value),"h9V",g);return d.join("")}function e(a){var b=+("e"==a),c=b?1:-1,d=g/3;return"M"+.5*c+","+d+"A6,6 0 0 "+b+" "+6.5*c+","+(d+6)+"V"+(2*d-6)+"A6,6 0 0 "+b+" "+.5*c+","+2*d+"ZM"+2.5*c+","+(d+8)+"V"+(2*d-8)+"M"+4.5*c+","+(d+8)+"V"+(2*d-8)}var f=c.range()[1],g=m.range()[0];m.domain([0,j.top(1)[0].value]),a.each(function(){var a=d3.select(this),h=a.select("g");if(h.empty()){a.select(".title").append("a").attr("href","javascript:reset("+n+")").attr("class","reset").text("reset").style("display","none"),h=a.append("svg").attr("width",f+l.left+l.right).attr("height",g+l.top+l.bottom).append("g").attr("transform","translate("+l.left+","+l.top+")"),h.append("clipPath").attr("id","clip-"+n).append("rect").attr("width",f).attr("height",g),h.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(a){return a+" bar"}).datum(j.all()),h.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+n+")"),h.append("g").attr("class","axis").attr("transform","translate(0,"+g+")").call(o);var i=h.append("g").attr("class","brush").call(p);i.selectAll("rect").attr("height",g),i.selectAll(".resize").append("path").attr("d",e)}if(d)if(d=!1,h.selectAll(".brush").call(p),a.select(".title a").style("display",p.empty()?"none":null),p.empty())h.selectAll("#clip-"+n+" rect").attr("x",0).attr("width",f);else{var k=p.extent();h.selectAll("#clip-"+n+" rect").attr("x",c(k[0])).attr("width",c(k[1])-c(k[0]))}h.selectAll(".bar").attr("d",b)})}i.id||(i.id=0);var c,d,e,j,k,l={top:10,right:10,bottom:20,left:10},m=d3.scale.linear().range([100,0]),n=i.id++,o=d3.svg.axis().orient("bottom"),p=d3.svg.brush();return p.on("brushstart.chart",function(){d3.select(this.parentNode.parentNode.parentNode).select(".title a").style("display",null)}),p.on("brush.chart",function(){function a(){h(),i=p.extent(),userTimeData=[],i.forEach(function(a){var b=String(a.getTime()/1e3*1e3);userTimeData.push(b)}),b.fingerPrintsMode&&(g(),b.showFingerPrints(),document.getElementById("fingerPrints-mode").classList.add("draggable-border-green")),b.radioHeatmapRSSMode&&(f(),b.showRadioHeatmapRSS(),b.radioHeatmapRSSMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","YES"),b.anyService.radioHeatmapRSSMode=!0,document.getElementById("radioHeatmapRSS-mode").classList.add("draggable-border-green"))}var d=d3.select(this.parentNode),i=p.extent();k&&d.select(".brush").call(p.on("brushend",a)).selectAll(".resize").style("display",null),d.select("#clip-"+n+" rect").attr("x",c(i[0])).attr("width",c(i[1])-c(i[0])),e.filterRange(i)}),p.on("brushend.chart",function(){if(p.empty()){var a=d3.select(this.parentNode.parentNode.parentNode);a.select(".title a").style("display","none"),a.select("#clip-"+n+" rect").attr("x",null).attr("width","100%"),e.filterAll()}}),a.margin=function(b){return arguments.length?(l=b,a):l},a.x=function(b){return arguments.length?(c=b,o.scale(c),p.x(c),a):c},a.y=function(b){return arguments.length?(m=b,a):m},a.dimension=function(b){return arguments.length?(e=b,a):e},a.filter=function(b){return b?(p.extent(b),e.filterRange(b)):(p.clear(),e.filterAll()),d=!0,a},a.group=function(b){return arguments.length?(j=b,a):j},a.round=function(b){return arguments.length?(k=b,a):k},d3.rebind(a,p,"on")}var j=d3.format(",d");a.forEach(function(a,b){a.index=b,a.date=e(a.date)});var k=crossfilter(a),l=k.groupAll(),m=k.dimension(function(a){return a.date}),n=m.group(d3.time.day).reduceSum(function(a){return a.count}),o=a[a.length-1].date.toString(),p=new Date(o);p.setDate(p.getDate()+5);var q=[i().dimension(m).group(n).round(d3.time.day.round).x(d3.time.scale().domain([a[0].date,p]).rangeRound([0,1e3])).filter([a[0].date,p])],r=d3.selectAll(".chart").data(q).each(function(a){a.on("brush",d).on("brushend",d)});d3.selectAll("#total").text(j(k.size())),d(),window.filter=function(a){a.forEach(function(a,b){q[b].filter(a)}),d()},window.reset=function(a){q[a].filter(null),d()}}b.anyService=c,b.anyAPI=e,b.gmapService=d,b.example9model=[],b.example9data=[],b.example9settings={enableSearch:!0,scrollable:!0},b.example8model=[],b.example8data=[],b.deleteButtonWarning=!1,b.radioHeatmapRSSMode=!1,b.radioHeatmapRSSTimeMode=!1,b.fingerPrintsMode=!1,b.fingerPrintsTimeMode=!1,b.APsMode=!1,b.filterByMAC=!1,b.filterByMAN=!1,b.radioHeatmapRSSHasGreen=!1,b.radioHeatmapRSSHasYellow=!1,b.radioHeatmapRSSHasOrange=!1,b.radioHeatmapRSSHasPurple=!1,b.radioHeatmapRSSHasRed=!1,b.localizationAccMode=!1,b.selected="Filters:",b.initializeTime=!1,b.initializeFingerPrints=!1,b.initializeRadioHeatmapRSS=!1,b.initializeAPs=!1,b.initializeConnections=!1,b.initializePOIs=!1,b.initializeAcces=!1;var m,n,o=1e3,p=19,q=21,r=22;b.crudTabSelected=1,b.setCrudTabSelected=function(a){b.crudTabSelected=a},b.isCrudTabSelected=function(a){return b.crudTabSelected===a},b.data={floor_plan_coords:{},floor_plan_base64_data:{},floor_plan_groundOverlay:null},b.$watch("anyService.selectedBuilding",function(a,c){function d(){$("#wifiTab").click(),$("#FPs").click(),$("#FPsButton").click()}function e(){$("#wifiTab").click(),$("#HMs").click(),$("#HMsButton").click()}function f(){$("#wifiTab").click(),$("#HMs").click(),$("#APsButton").click()}function g(){$("#wifiTab").click(),$("#LAs").click(),$("#LAButton").click()}function h(){$("#FPs").click(),$("#connectionsButton").click()}function i(){$("#FPs").click(),$("#POIsButton").click()}function j(){$("#wifiTab").click(),$("#FPs").click(),$("#FPsTimeButton").click()}if(a){if(void 0!==localStorage.getItem("fingerprintsMode")&&"YES"===localStorage.getItem("fingerprintsMode")&&(b.initializeFingerPrints=!0),void 0!==localStorage.getItem("radioHeatmapRSSMode")&&"YES"===localStorage.getItem("radioHeatmapRSSMode")&&(b.initializeRadioHeatmapRSS=!0),void 0!==localStorage.getItem("APsMode")&&"YES"===localStorage.getItem("APsMode")&&(b.initializeAPs=!0),void 0!==localStorage.getItem("localizationAccMode")&&"YES"===localStorage.getItem("localizationAccMode")&&(b.initializeAcces=!0),void 0!==localStorage.getItem("connectionsMode")&&"NO"===localStorage.getItem("connectionsMode")&&(b.initializeConnections=!0),void 0!==localStorage.getItem("POIsMode")&&"NO"===localStorage.getItem("POIsMode")&&(b.initializePOIs=!0),void 0!==localStorage.getItem("fingerPrintsTimeMode")&&"YES"===localStorage.getItem("fingerPrintsTimeMode")&&(b.initializeTime=!0),window.onload=function(){b.initializeFingerPrints&&d(),b.initializeRadioHeatmapRSS&&e(),b.initializeAPs&&f(),b.initializeAcces&&g(),b.initializeConnections&&h(),b.initializePOIs&&i(),b.initializeTime&&j()},_HEATMAP_RSS_IS_ON){for(var k=heatMap.length;k--;)heatMap[k].rectangle.setMap(null),heatMap[k]=null;heatMap=[],b.showRadioHeatmapRSS(),b.radioHeatmapRSSTimeMode&&(d3.selectAll("svg > *").remove(),b.getFingerPrintsTime())}if(_APs_IS_ON){for(var k=APmap.length;k--;)APmap[k].setMap(null),APmap[k]=null,b.example9data[k]=null,b.example9model[k]=null;for(k=b.example8data.length;k--;)b.example8data[k]=null,b.example8model[k]=null;APmap=[],b.example9data=[],b.example9model=[],b.example8data=[],b.example8model=[],b.showAPs()}if(_FINGERPRINTS_IS_ON){for(var k=fingerPrintsMap.length;k--;)fingerPrintsMap[k].setMap(null),fingerPrintsMap[k]=null;fingerPrintsMap=[],b.showFingerPrints(),b.fingerPrintsTimeMode&&!b.radioHeatmapRSSTimeMode&&(d3.selectAll("svg > *").remove(),b.getFingerPrintsTime())}if(heatmap&&heatmap.getMap()){heatmap.setMap(null);for(var k=heatmapFingerprints.length;k--;)heatmapFingerprints[k]=null;heatmapFingerprints=[],_HEATMAP_F_IS_ON=!1,b.showFingerPrints()}var l=0;if(!_CONNECTIONS_IS_ON){connectionsMap=b.anyService.getAllConnections();var m=Object.keys(connectionsMap);if(void 0!==connectionsMap[m[l]]&&void 0!==connectionsMap[m[l]].polyLine&&null!==connectionsMap[m[l]].polyLine.getMap()){for(var m in connectionsMap)if(connectionsMap.hasOwnProperty(m)){var n=connectionsMap[m];n&&n.polyLine&&n.polyLine.setMap(null)}b.anyService.setAllConnection(connectionsMap),connectionsMap={}}}if(!_POIS_IS_ON&&void 0!==(POIsMap=b.anyService.getAllPois())){var m=Object.keys(POIsMap);if(void 0!==POIsMap[m[l]]&&null!==POIsMap[m[l]].marker.getMap()){for(var m in POIsMap)if(POIsMap.hasOwnProperty(m)){var o=POIsMap[m];o&&o.marker&&o.marker.setMap(null)}b.anyService.setAllPois(POIsMap),POIsMap={}}}changedfloor=!1}}),b.$watch("newFloorNumber",function(a,b){});var s=function(a){b.anyService.addAlert("danger",a)},t=function(a){b.anyService.addAlert("success",a)};b.$watch("anyService.selectedFloor",function(a,c){if(void 0!==a&&null!==a&&!_.isEqual(a,c)){if("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastFloor",a.floor_number),_HEATMAP_RSS_IS_ON){for(var d=heatMap.length;d--;)heatMap[d].rectangle.setMap(null),heatMap[d]=null;heatMap=[],b.showRadioHeatmapRSS(),b.radioHeatmapRSSTimeMode&&b.getFingerPrintsTime()}if(_APs_IS_ON){for(var d=APmap.length;d--;)APmap[d].setMap(null),APmap[d]=null,b.example9data[d]=null,b.example9model[d]=null;for(d=b.example8data.length;d--;)b.example8data[d]=null,b.example8model[d]=null;APmap=[],b.example9data=[],b.example9model=[],b.example8data=[],b.example8model=[],b.showAPs()}if(_FINGERPRINTS_IS_ON){for(var d=fingerPrintsMap.length;d--;)fingerPrintsMap[d].setMap(null),fingerPrintsMap[d]=null;fingerPrintsMap=[],b.showFingerPrints(),b.fingerPrintsTimeMode&&!b.radioHeatmapRSSTimeMode&&b.getFingerPrintsTime()}if(heatmap&&heatmap.getMap()){heatmap.setMap(null);for(var d=heatmapFingerprints.length;d--;)heatmapFingerprints[d]=null;heatmapFingerprints=[],_HEATMAP_F_IS_ON=!1,b.showFingerPrints()}var e=0;if(!_CONNECTIONS_IS_ON){connectionsMap=b.anyService.getAllConnections();var f=Object.keys(connectionsMap);if(void 0!==connectionsMap[f[e]]&&void 0!==connectionsMap[f[e]].polyLine&&null!==connectionsMap[f[e]].polyLine.getMap()){for(var f in connectionsMap)if(connectionsMap.hasOwnProperty(f)){var g=connectionsMap[f];g&&g.polyLine&&g.polyLine.setMap(null)}b.anyService.setAllConnection(connectionsMap),connectionsMap={}}}if(!_POIS_IS_ON&&void 0!==(POIsMap=b.anyService.getAllPois())){var f=Object.keys(POIsMap);if(void 0!==POIsMap[f[e]]&&null!==POIsMap[f[e]].marker.getMap()){for(var f in POIsMap)if(POIsMap.hasOwnProperty(f)){var h=POIsMap[f];h&&h.marker&&h.marker.setMap(null)}b.anyService.setAllPois(POIsMap),POIsMap={}}}changedfloor=!1}}),b.toggleRadioHeatmapRSS=function(){var c=0;if(void 0!==heatMap[c]&&null!==heatMap[c]||b.radioHeatmapRSSTimeMode){for(var d=heatMap.length;d--;)heatMap[d].rectangle.setMap(null),heatMap[d]=null;return heatMap=[],document.getElementById("radioHeatmapRSS-mode").classList.remove("draggable-border-green"),_HEATMAP_RSS_IS_ON=!1,j("g",!1),j("y",!1),j("o",!1),j("p",!1),j("r",!1),b.radioHeatmapRSSMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","NO"),b.anyService.radioHeatmapRSSMode=!1,b.radioHeatmapRSSTimeMode=!1,"undefined"!=typeof Storage&&localStorage&&!b.fingerPrintsTimeMode&&localStorage.setItem("fingerPrintsTimeMode","NO"),b.anyService.radioHeatmapRSSTimeMode=!1,b.radioHeatmapRSSHasGreen=!1,b.radioHeatmapRSSHasYellow=!1,b.radioHeatmapRSSHasOrange=!1,b.radioHeatmapRSSHasPurple=!1,b.radioHeatmapRSSHasRed=!1,b.fingerPrintsMode||document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green"),void a.put("RSSClicked","NO")}b.fingerPrintsTimeMode&&(b.radioHeatmapRSSTimeMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"),b.anyService.radioHeatmapRSSTimeMode=!0),document.getElementById("radioHeatmapRSS-mode").classList.add("draggable-border-green"),b.radioHeatmapRSSMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","YES"),b.anyService.radioHeatmapRSSMode=!0,b.showRadioHeatmapRSS()},b.toggleAPs=function(){var a=0;if(void 0!==APmap[a]&&null!==APmap[a]){for(var c=APmap.length;c--;)APmap[c].setMap(null),APmap[c]=null,b.example9data[c]=null,b.example9model[c]=null;for(c=b.example8data.length;c--;)b.example8data[c]=null,b.example8model[c]=null;return APmap=[],b.example9data=[],b.example9model=[],b.example8data=[],b.example8model=[],_APs_IS_ON=!1,b.filterByMAC=!1,b.filterByMAN=!1,document.getElementById("APs-mode").classList.remove("draggable-border-green"),b.APsMode=!1,void("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("APsMode","NO"))}_APs_IS_ON=!0,b.APsMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("APsMode","YES"),document.getElementById("APs-mode").classList.add("draggable-border-green"),b.showAPs()},b.toggleFingerPrints=function(){b.fingerPrintsMode=!b.fingerPrintsMode,b.fingerPrintsMode?(document.getElementById("fingerPrints-mode").classList.add("draggable-border-green"),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","YES")):(document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"));var a=0;if(void 0!==fingerPrintsMap[a]&&null!==fingerPrintsMap[a]){for(var c=fingerPrintsMap.length;c--;)fingerPrintsMap[c].setMap(null),fingerPrintsMap[c]=null;return fingerPrintsMap=[],_FINGERPRINTS_IS_ON=!1,document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),b.fingerPrintsMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"),b.fingerPrintsTimeMode=!1,"undefined"!=typeof Storage&&localStorage&&!b.radioHeatmapRSSTimeMode&&localStorage.setItem("fingerPrintsTimeMode","NO"),b.anyService.fingerPrintsTimeMode=!1,void(b.radioHeatmapRSSMode||document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green"))}if(heatmap&&heatmap.getMap()){heatmap.setMap(null),_FINGERPRINTS_IS_ON=!1,document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),b.fingerPrintsMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"),b.fingerPrintsTimeMode=!1,"undefined"!=typeof Storage&&localStorage&&!b.radioHeatmapRSSTimeMode&&localStorage.setItem("fingerPrintsTimeMode","NO"),b.anyService.fingerPrintsTimeMode=!1,_HEATMAP_F_IS_ON=!1,b.radioHeatmapRSSMode||document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green");for(var c=heatmapFingerprints.length;c--;)heatmapFingerprints[c]=null;return void(heatmapFingerprints=[])}document.getElementById("fingerPrints-mode").classList.add("draggable-border-green"),b.fingerPrintsMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","YES"),b.radioHeatmapRSSTimeMode&&(b.fingerPrintsTimeMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"),b.anyService.fingerPrintsTimeMode=!0),b.showFingerPrints()},b.toggleLocalizationAccurancy=function(){if(b.localizationAccMode=!b.localizationAccMode,heatmapAcc&&heatmapAcc.getMap())return heatmapAcc.setMap(null),document.getElementById("localizationAccurancy-mode").classList.remove("draggable-border-green"),void("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("localizationAccMode","NO"));document.getElementById("localizationAccurancy-mode").classList.add("draggable-border-green"),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("localizationAccMode","YES"),b.showLocalizationAccHeatmap()},b.toggleFingerPrintsTime=function(){b.fingerPrintsMode&&(b.fingerPrintsTimeMode=!b.fingerPrintsTimeMode,b.fingerPrintsTimeMode?"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"):"undefined"!=typeof Storage&&localStorage&&!b.radioHeatmapRSSTimeMode&&localStorage.setItem("fingerPrintsTimeMode","NO"),b.anyService.fingerPrintsTimeMode=!b.anyService.fingerPrintsTimeMode),b.radioHeatmapRSSMode&&(b.radioHeatmapRSSTimeMode=!b.radioHeatmapRSSTimeMode,b.radioHeatmapRSSTimeMode?"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"):"undefined"!=typeof Storage&&localStorage&&!b.fingerPrintsTimeMode&&localStorage.setItem("fingerPrintsTimeMode","NO"),b.anyService.radioHeatmapRSSTimeMode=!b.anyService.radioHeatmapRSSTimeMode),!b.fingerPrintsTimeMode&&b.fingerPrintsMode&&(g(),b.showFingerPrints(),document.getElementById("fingerPrints-mode").classList.add("draggable-border-green"),document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green")),!b.radioHeatmapRSSTimeMode&&b.radioHeatmapRSSMode&&(f(),b.showRadioHeatmapRSS(),b.radioHeatmapRSSMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","YES"),b.anyService.radioHeatmapRSSMode=!0,document.getElementById("radioHeatmapRSS-mode").classList.add("draggable-border-green"),document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green")),(b.radioHeatmapRSSTimeMode||b.fingerPrintsTimeMode)&&b.getFingerPrintsTime()},b.togglePOIs=function(){POIsMap=b.anyService.getAllPois();var a=Object.keys(POIsMap),c=0;if(!POIsMap.hasOwnProperty(a[c]))return void s("No POIs yet.");if(null!==POIsMap[a[c]].marker.getMap()&&void 0!==POIsMap[a[c]].marker.getMap()){for(var a in POIsMap)if(POIsMap.hasOwnProperty(a)){var e=POIsMap[a];e&&e.marker&&e.marker.setMap(null)}return b.anyService.setAllPois(POIsMap),POIsMap={},_POIS_IS_ON=!1,void("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("POIsMode","NO"))}for(var a in POIsMap)if(POIsMap.hasOwnProperty(a)){var e=POIsMap[a];e&&e.marker&&e.marker.setMap(d.gmap)}b.anyService.setAllPois(POIsMap),_POIS_IS_ON=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("POIsMode","YES")},b.toggleConnections=function(){connectionsMap=b.anyService.getAllConnections();var a=Object.keys(connectionsMap),c=0;if(!connectionsMap.hasOwnProperty(a[c]))return void s("No edges yet.")
;if(void 0!==connectionsMap[a[c]].polyLine&&void 0!==connectionsMap[a[c]].polyLine.getMap()&&null!==connectionsMap[a[c]].polyLine.getMap()){for(var a in connectionsMap)if(connectionsMap.hasOwnProperty(a)){var d=connectionsMap[a];d&&d.polyLine&&d.polyLine.setMap(null)}return b.anyService.setAllConnection(connectionsMap),connectionsMap={},_CONNECTIONS_IS_ON=!1,void("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("connectionsMode","NO"))}b.showConnections()},b.getHeatMapButtonText=function(){var a=0;return void 0!==heatMap[a]&&null!==heatMap[a]?"Hide WiFi Map":"Show WiFi Map"},b.getAPsButtonText=function(){var a=0;return void 0!==APmap[a]&&null!==APmap[a]?"Hide Estimated Wi-Fi AP Position":"Show Estimated Wi-Fi AP Position"},b.getFingerPrintsButtonText=function(){var a=0;return void 0!==fingerPrintsMap[a]&&null!==fingerPrintsMap[a]||heatmap&&heatmap.getMap()?"Hide FingerPrints":"Show FingerPrints"},b.getFingerPrintTimeButtonText=function(){return b.fingerPrintsTimeMode?"Hide FingerPrints By Time":"Show FingerPrints By Time"},b.getHeatMapTimeButtonText=function(){return b.radioHeatmapRSSTimeMode?"Hide WiFi Map By Time":"Show WiFi Map By Time"},b.getLocalizationAccurancyText=function(){return b.localizationAccMode?"Hide Acces Map":"Show Acces Map"},b.getPOIsButtonText=function(){POIsMap=b.anyService.getAllPois();var a=Object.keys(POIsMap),c=0;return POIsMap.hasOwnProperty(a[c])&&void 0!==POIsMap[a[c]].marker.getMap()&&null!==POIsMap[a[c]].marker.getMap()?(document.getElementById("POIs-mode").classList.add("draggable-border-green"),b.POIsMode=!0,"Hide POIs"):(document.getElementById("POIs-mode").classList.remove("draggable-border-green"),b.POIsMode=!1,"Show POIs")},b.getConnectionsButtonText=function(){connectionsMap=b.anyService.getAllConnections();var a=Object.keys(connectionsMap),c=0;return connectionsMap.hasOwnProperty(a[c])&&void 0!==connectionsMap[a[c]].polyLine&&void 0!==connectionsMap[a[c]].polyLine.getMap()&&null!==connectionsMap[a[c]].polyLine.getMap()?(document.getElementById("connections-mode").classList.add("draggable-border-green"),b.connectionsMode=!0,"Hide Edges"):(document.getElementById("connections-mode").classList.remove("draggable-border-green"),b.connectionsMode=!1,"Show Edges")},$("#HMs_1").unbind().click(function(){$("#wifiTab").click(),$("#HMs").click(),$("#HMsButton").click()}),$("#APs_1").unbind().click(function(){$("#wifiTab").click(),$("#HMs").click(),$("#APsButton").click()}),$("#FPs_1").unbind().click(function(){$("#wifiTab").click(),$("#FPs").click(),$("#FPsButton").click()}),$("#DL_1").unbind().click(function(){$("#wifiTab").click(),$("#FPs").click(),$("#deleteButton").click()}),$("#FPs_2").unbind().click(function(){$("#wifiTab").click(),$("#FPs").click(),$("#FPsTimeButton").click()}),$("#LA_1").unbind().click(function(){$("#wifiTab").click(),$("#LAs").click(),$("#LAButton").click()}),$("#POIs_1").unbind().click(function(){$("#FPs").click(),$("#POIsButton").click()}),$("#CNs_1").unbind().click(function(){$("#FPs").click(),$("#connectionsButton").click()}),b.getHeatmapModeText=function(){return b.radioHeatmapRSSMode?"WiFi Map is online":"WiFi Map is offline"},b.getAPsModeText=function(){return b.APsMode?"Estimated Wi-Fi AP Position is online":"Estimated Wi-Fi AP Position is offline"},b.getFingerPrintsModeText=function(){return b.fingerPrintsMode?"FingerPrints are online":"FingerPrints are offline"},b.getDeleteFingerPrintsModeText=function(){return b.deleteFingerPrintsMode?"ON":"OFF"},b.getFingerPrintsTimeModeText=function(){return b.fingerPrintsTimeMode||b.radioHeatmapRSSTimeMode?"ON":"OFF"},b.getLocalizationAccurancyModeText=function(){return b.localizationAccMode?"Localization is online":"Localization is offline"},b.getPOIsModeText=function(){return b.POIsMode?"POIs are online":"POIs are offline"},b.getConnectionsModeText=function(){return b.connectionsMode?"Edges are online":"Edges are offline"},b.deleteFingerPrints=function(){if(_DELETE_FINGERPRINTS_IS_ON)return drawingManager.setMap(null),b.deleteButtonWarning=!1,document.getElementById("delete-mode").classList.remove("draggable-border-green"),_DELETE_FINGERPRINTS_IS_ON=!1,void(b.deleteFingerPrintsMode=!1);if(!(_FINGERPRINTS_IS_ON||heatmap&&heatmap.getMap()))return void s("You have to press show fingerPrints button first");b.deleteButtonWarning=!0,b.deleteFingerPrintsMode=!0,_DELETE_FINGERPRINTS_IS_ON=!0,document.getElementById("delete-mode").classList.add("draggable-border-green"),drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.RECTANGLE,drawingControl:!1,rectangleOptions:{strokeColor:"#13B3E7",fillColor:"#ADD8E6",fillOpacity:.5}}),drawingManager.setMap(d.gmap);var a,c,e,f;google.maps.event.addListener(drawingManager,"overlaycomplete",function(d){a=d.overlay.getBounds(),c=a.getNorthEast(),e=a.getSouthWest();for(var g=fingerPrintsMap.length;g--;)if(fingerPrintsMap[g].getPosition().lat()<=c.lat()&&fingerPrintsMap[g].getPosition().lng()<=c.lng()&&fingerPrintsMap[g].getPosition().lat()>=e.lat()&&fingerPrintsMap[g].getPosition().lng()>=e.lng()){f=confirm("Confirm:\nAre you sure you want to delete the selected fingerprints?");break}for(g=heatmapFingerprints.length;g--;)if(heatmapFingerprints[g].getPosition().lat()<=c.lat()&&heatmapFingerprints[g].getPosition().lng()<=c.lng()&&heatmapFingerprints[g].getPosition().lat()>=e.lat()&&heatmapFingerprints[g].getPosition().lng()>=e.lng()){f=confirm("Confirm:\nAre you sure you want to delete the selected fingerprints?");break}if(void 0===f)return alert("You have to select an area with Fingerprints to delete. "),d.overlay.setMap(null),drawingManager.setMap(null),b.deleteButtonWarning=!1,_DELETE_FINGERPRINTS_IS_ON=!1,b.deleteFingerPrintsMode=!1,void document.getElementById("delete-mode").classList.remove("draggable-border-green");if(f){var h=b.anyService.getBuilding(),i=b.anyService.getFloorNumber(),j=b.creds;if(!b.owner_id)return void s("Could not identify user. Please refresh and sign in again.");if(j.owner_id=b.owner_id,!h||!h.buid)return void s("No building selected");j.buid=h.buid,j.floor=i,j.lat1=c.lat()+"",j.lon1=c.lng()+"",j.lat2=e.lat()+"",j.lon2=e.lng()+"";var k=[],l=b.anyAPI.deleteFingerprints(j);_HEATMAP_F_IS_ON||_HEATMAP_RSS_IS_ON?_HEATMAP_F_IS_ON&&!_HEATMAP_RSS_IS_ON?t("The fingerprints are scheduled to be deleted. A new radiomap for fingerprints will be regenerated shortly after."):!_HEATMAP_F_IS_ON&&_HEATMAP_RSS_IS_ON?t("The fingerprints are scheduled to be deleted. A new radiomap for Wi-Fi coverage will be regenerated shortly after."):_HEATMAP_F_IS_ON&&_HEATMAP_RSS_IS_ON&&t("The fingerprints are scheduled to be deleted. New radiomaps for fingerprints and Wi-Fi coverage will be regenerated shortly after."):t("The fingerprints are scheduled to be deleted."),l.then(function(a){if(k=a.data.radioPoints,console.log("fingerPrints deleted "),k.length>0){for(f=fingerPrintsMap.length;f--;)fingerPrintsMap[f].getPosition().lat()<=c.lat()&&fingerPrintsMap[f].getPosition().lng()<=c.lng()&&fingerPrintsMap[f].getPosition().lat()>=e.lat()&&fingerPrintsMap[f].getPosition().lng()>=e.lng()&&fingerPrintsMap[f].setMap(null);if(_HEATMAP_F_IS_ON){heatmap.setMap(null);var d=[];for(f=heatmapFingerprints.length;f--;)null!==heatmapFingerprints[f]&&(heatmapFingerprints[f].getPosition().lat()>c.lat()||heatmapFingerprints[f].getPosition().lng()>c.lng()||heatmapFingerprints[f].getPosition().lat()<e.lat()||heatmapFingerprints[f].getPosition().lng()<e.lng()?d.push({location:heatmapFingerprints[f].getPosition(),weight:1}):heatmapFingerprints[f]=null);heatmap=new google.maps.visualization.HeatmapLayer({data:d}),heatmap.setMap(b.gmapService.gmap)}if(_HEATMAP_RSS_IS_ON)for(var f=heatMap.length;f--;)heatMap[f].location.lat()<=c.lat()&&heatMap[f].location.lng()<=c.lng()&&heatMap[f].location.lat()>=e.lat()&&heatMap[f].location.lng()>=e.lng()&&heatMap[f].rectangle.setMap(null)}t("Successfully deleted "+k.length+" fingerPrints.")},function(a){a.data;s("Something went wrong. It's likely that everything related to the fingerPrints is deleted but please refresh to make sure or try again."),document.getElementById("delete-mode").classList.remove("draggable-border-green")})}d.overlay.setMap(null),drawingManager.setMap(null),b.deleteButtonWarning=!1,_DELETE_FINGERPRINTS_IS_ON=!1,b.deleteFingerPrintsMode=!1,document.getElementById("delete-mode").classList.remove("draggable-border-green")})},b.getColorBarTextFor=function(a){return k(a.charAt(0))?"click to show "+a+" ones":"click to hide "+a+" ones"},b.hideRSSExcept=function(a){if("g"===a&&!b.radioHeatmapRSSHasGreen)return void s("Wi-Fi coverage map has no green squares");if("y"===a&&!b.radioHeatmapRSSHasYellow)return void s("Wi-Fi coverage map has no yellow squares");if("o"===a&&!b.radioHeatmapRSSHasOrange)return void s("Wi-Fi coverage map has no orange squares");if("p"===a&&!b.radioHeatmapRSSHasPurple)return void s("Wi-Fi coverage map has no purple squares");if("r"===a&&!b.radioHeatmapRSSHasRed)return void s("Wi-Fi coverage map has no red squares");for(var c=heatMap.length;c--;)k(a)?heatMap[c].id===a&&(heatMap[c].rectangle.setMap(b.gmapService.gmap),heatMap[c].clicked=!0):heatMap[c].id===a&&(heatMap[c].rectangle.setMap(null),heatMap[c].clicked=!1);j(a,!k(a))},b.showRadioHeatmapRSS=function(){var c,e;m=d.gmap.getZoom(),(b.radioHeatmapRSSTimeMode||b.fingerPrintsTimeMode)&&userTimeData.length>0?(c={buid:b.anyService.getBuildingId(),floor:b.anyService.getFloorNumber(),timestampX:userTimeData[0],timestampY:userTimeData[1]},c.username=b.creds.username,c.password=b.creds.password,m>p&&m<q?(levelOfZoom=2,e=b.anyAPI.getRadioHeatmapRSSByTime_2(c)):m>p?(levelOfZoom=3,e=b.anyAPI.getRadioHeatmapRSSByTime_3(c)):(levelOfZoom=1,e=b.anyAPI.getRadioHeatmapRSSByTime_1(c))):(c={buid:b.anyService.getBuildingId(),floor:b.anyService.getFloorNumber()},c.username=b.creds.username,c.password=b.creds.password,e=m>p&&m<q?b.anyAPI.getRadioHeatmapRSS_2(c):m>p?b.anyAPI.getRadioHeatmapRSS_3(c):b.anyAPI.getRadioHeatmapRSS_1(c)),e.then(function(c){var d=(c.data,[]),e=c.data.radioPoints.length;if(e<=0)return s("This floor seems not to be WiFi mapped. Download the Anyplace app from the Google Play store to map the floor."),void(b.radioHeatmapRSSTimeMode?s("No fingerprints at this period.\n Please choose another one."):(document.getElementById("radioHeatmapRSS-mode").classList.remove("draggable-border-green"),b.radioHeatmapRSSMode=!1,"undefined"!=typeof Storage&&localStorage&&!b.fingerPrintsTimeMode&&localStorage.setItem("radioHeatmapRSSMode","NO")));for(var f=0;e--;){var g=c.data.radioPoints[e],h=JSON.parse(g.w),i=parseInt(h.average);i<=-30&&i>=-60?(d.push({location:new google.maps.LatLng(g.x,g.y),weight:i,color:"#4ed419",id:"g"}),b.radioHeatmapRSSHasGreen=!0):i<=-61&&i>=-70?(d.push({location:new google.maps.LatLng(g.x,g.y),weight:i,color:"#ffff00",id:"y"}),b.radioHeatmapRSSHasYellow=!0):i<=-71&&i>=-90?(d.push({location:new google.maps.LatLng(g.x,g.y),weight:i,color:"#ffa500",id:"o"}),b.radioHeatmapRSSHasOrange=!0):i<=-91&&i>=-100?(d.push({location:new google.maps.LatLng(g.x,g.y),weight:i,color:"#bd06bd",id:"p"}),b.radioHeatmapRSSHasPurple=!0):(d.push({location:new google.maps.LatLng(g.x,g.y),weight:i,color:"#ff0000",id:"r"}),b.radioHeatmapRSSHasRed=!0);var j,l=d[f].location;j=3==levelOfZoom?new google.maps.Size(1,1):2==levelOfZoom?new google.maps.Size(2,2):new google.maps.Size(5,5);var m=google.maps.geometry.spherical.computeOffset(l,j.height,0).lat(),n=google.maps.geometry.spherical.computeOffset(l,j.height,180).lat(),o=google.maps.geometry.spherical.computeOffset(l,j.width,90).lng(),i=google.maps.geometry.spherical.computeOffset(l,j.width,270).lng(),p=new google.maps.Rectangle({strokeColor:d[f].color,strokeOpacity:1,strokeWeight:1,fillColor:d[f].color,fillOpacity:.5,bounds:new google.maps.LatLngBounds(new google.maps.LatLng(n,i),new google.maps.LatLng(m,o))});k(d[f].id)?p.setMap(null):p.setMap(b.gmapService.gmap),heatMap.push({rectangle:p,location:l,id:d[f].id,clicked:!1}),f++,c.data.radioPoints.splice(e,1)}_HEATMAP_RSS_IS_ON=!0,a.put("RSSClicked","YES")},function(a){a.data;s("Something went wrong while fetching radio heatmap."),b.radioHeatmapRSSTimeMode||(b.radioHeatmapRSSMode=!1,"undefined"!=typeof Storage&&localStorage&&!b.fingerPrintsTimeMode&&localStorage.setItem("radioHeatmapRSSMode","NO"),document.getElementById("radioHeatmapRSS-mode").classList.remove("draggable-border-green"))})},b.getAPsIds=function(a){var c={};c.ids=a,b.anyAPI.getAPsIds(c).then(function(a){var c=a.data.accessPoints,d=c.length;if(d<=0)return void s("Access Points seems to not have ids");for(var e=new Set;d--;)APmap[d].mun=c[d],e.add(c[d]);e.forEach(function(a){"N/A"!==a&&(b.example8data.push({id:a,label:a}),b.example8model.push({id:a,label:a}))})},function(a){a.data,s("Something went wrong while fetching the ids of access points.")})},b.showAPs=function(){var a={buid:b.anyService.getBuildingId(),floor:b.anyService.getFloorNumber()};a.username=b.creds.username,a.password=b.creds.password;var c;b.anyAPI.getAPs(a).then(function(a){if((c=a.data.accessPoints.length)<=0)return s("This floor seems not to be Access Point mapped. Download the Anyplace app from the Google Play store to map the floor."),b.APsMode=!1,void document.getElementById("APs-mode").classList.remove("draggable-border-green");var e=a.data.accessPoints;c=e.length;var f="build/images/access-point-icon.png",g=f,h=new google.maps.Size(21,32);c=e.length;for(var i,j,k=0,l=[];c--;){if(k==o){s("Access Points have exceeded the maximun limit of 1000");break}0!=e[c].den?(i=e[c].x/e[c].den,j=e[c].y/e[c].den):(i=e[c].x,j=e[c].y),b.example9data.push({id:e[c].AP,label:e[c].AP}),b.example9model.push({id:e[c].AP,label:e[c].AP});var m=new google.maps.Marker({id:e[c].AP,position:new google.maps.LatLng(i,j),map:d.gmap,icon:{url:g,scaledSize:h}});APmap.push(m),l.push(m.id);var n=new google.maps.InfoWindow;n.getMap()||APmap[k].addListener("click",function(){"N/A"!==this.mun?n.setContent(this.id+"<br><center>-</center><br>"+this.mun):n.setContent(this.id),n.open(this.gmap,this)}),k++}b.getAPsIds(l)},function(a){a.data,b.APsMode=!1,s("Something went wrong while fetching Access Points."),document.getElementById("APs-mode").classList.remove("draggable-border-green")})},b.getFingerPrintsTime=function(){var a={buid:b.anyService.getBuildingId(),floor:b.anyService.getFloorNumber()};a.username=b.creds.username,a.password=b.creds.password,b.anyAPI.getFingerprintsTime(a).then(function(a){var b=a.data.radioPoints;if(b.length<=0)return void s("This floor seems not to be FingerPrint mapped. Download the Anyplace app from the Google Play store to map the floor.");l(b),h()},function(a){a.data,s("Something went wrong while fetching fingerPrints timestamp.")})},b.showFingerPrints=function(){var a,c;(b.fingerPrintsTimeMode||b.radioHeatmapRSSTimeMode)&&userTimeData.length>0?(a={buid:b.anyService.getBuildingId(),floor:b.anyService.getFloorNumber(),timestampX:userTimeData[0],timestampY:userTimeData[1]},a.username=b.creds.username,a.password=b.creds.password,c=b.anyAPI.getRadioHeatmapRSSByTime(a)):(a={buid:b.anyService.getBuildingId(),floor:b.anyService.getFloorNumber()},a.username=b.creds.username,a.password=b.creds.password,c=b.anyAPI.getRadioHeatmapRSS_3(a)),c.then(function(a){var c=(a.data,[]),e=a.data.radioPoints.length;if(e<=0)return void(b.fingerPrintsTimeMode?s("No fingerprints at this period.\n Please choose another one."):(s("This floor seems not to be FingerPrint mapped. Download the Anyplace app from the Google Play store to map the floor."),document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),b.fingerPrintsMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO")));if(m==r){for(;e--;){var f=a.data.radioPoints[e];c.push({location:new google.maps.LatLng(f.x,f.y)}),a.data.radioPoints.splice(e,1)}var g="build/images/fingerPrint-icon.png",h=g,i=new google.maps.Size(21,32);for(e=c.length;e--;){var j=new google.maps.Marker({position:c[e].location,map:d.gmap,icon:new google.maps.MarkerImage(h,null,null,null,i)});fingerPrintsMap.push(j)}_FINGERPRINTS_IS_ON=!0}else{for(var k=[],l=0;e--;){var f=a.data.radioPoints[e];JSON.parse(f.w);k.push({location:new google.maps.LatLng(f.x,f.y),weight:1});var j=new google.maps.Marker({position:k[l].location});heatmapFingerprints.push(j),a.data.radioPoints.splice(e,1),l++}heatmap=new google.maps.visualization.HeatmapLayer({data:k}),heatmap.setMap(b.gmapService.gmap),_HEATMAP_F_IS_ON=!0}},function(a){a.data;s("Something went wrong while fetching fingerPrints."),b.fingerPrintsMode||(document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),b.fingerPrintsMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"))})},b.showLocalizationAccHeatmap=function(){var a={buid:b.anyService.getBuildingId(),floor:b.anyService.getFloorNumber()};a.username=b.creds.username,a.password=b.creds.password,b.anyAPI.getHeatmapAcces(a).then(function(a){var c=a.data.crlb,d=a.data.geojson.coordinates,e=d.length;if(e<=0)return s("This floor seems not to be FingerPrint mapped. Download the Anyplace app from the Google Play store to map the floor."),document.getElementById("localizationAccurancy-mode").classList.remove("draggable-border-green"),b.localizationAccMode=!1,void("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("localizationAccMode","NO"));for(var f=[];e--;){var g=d[e];f.push({location:new google.maps.LatLng(g[0],g[1]),weight:c[e]}),d.splice(e,1)}heatmapAcc=new google.maps.visualization.HeatmapLayer({data:f});var h=["rgba(0, 255, 255, 0)","rgba(0, 255, 255, 1)","rgba(0, 191, 255, 1)","rgba(0, 127, 255, 1)","rgba(0, 63, 255, 1)","rgba(0, 0, 255, 1)","rgba(0, 0, 223, 1)","rgba(0, 0, 191, 1)","rgba(0, 0, 159, 1)","rgba(0, 0, 127, 1)","rgba(63, 0, 91, 1)","rgba(127, 0, 63, 1)","rgba(191, 0, 31, 1)","rgba(255, 0, 0, 1)"];heatmapAcc.set("gradient",h),heatmapAcc.setMap(b.gmapService.gmap)},function(a){a.data,s("Something went wrong while fetching fingerPrints."),document.getElementById("localizationAccurancy-mode").classList.remove("draggable-border-green"),b.localizationAccMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("localizationAccMode","NO")})},b.showConnections=function(){for(var a in connectionsMap)if(connectionsMap.hasOwnProperty(a)){var c=connectionsMap[a];c&&c.polyLine&&c.polyLine.setMap(d.gmap)}_CONNECTIONS_IS_ON=!0,b._CONNECTIONS_IS_ON=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("connectionsMode","YES"),b.anyService.setAllConnection(connectionsMap)},d.gmap.addListener("zoom_changed",function(){if(m=d.gmap.getZoom(),_HEATMAP_RSS_IS_ON&&(n==p&&m>n||n>p&&n<q&&(m<=p||m>=q)||n==q&&m<n)){for(var a=heatMap.length;a--;)heatMap[a].rectangle.setMap(null),heatMap[a]=null;heatMap=[],b.showRadioHeatmapRSS()}if((_FINGERPRINTS_IS_ON||heatmap&&heatmap.getMap())&&!changedfloor&&(m==r||n==r)){for(var a=fingerPrintsMap.length;a--;)fingerPrintsMap[a].setMap(null),fingerPrintsMap[a]=null;if(fingerPrintsMap=[],heatmap&&heatmap.getMap()){heatmap.setMap(null);for(var a=heatmapFingerprints.length;a--;)heatmapFingerprints[a]=null;heatmapFingerprints=[],_HEATMAP_F_IS_ON=!1}b.showFingerPrints()}n=m}),b.selectFilterForAPs=function(){switch(b.selected){case"0":b.filterByMAC=!0,b.filterByMAN=!1;break;default:b.filterByMAC=!1,b.filterByMAN=!0}},b.multiuserevents={onItemDeselect:function(a){for(i=APmap.length;i--;)if(APmap[i].id==a.id){APmap[i].setVisible(!1);break}},onItemSelect:function(a){for(i=APmap.length;i--;)if(APmap[i].id==a.id){APmap[i].setVisible(!0);break}},onDeselectAll:function(){for(i=APmap.length;i--;)APmap[i].setVisible(!1)}},b.multiuserevents1={onItemDeselect:function(a){for(i=APmap.length;i--;)if(APmap[i].mun==a.id){APmap[i].setVisible(!1);break}},onItemSelect:function(a){for(i=APmap.length;i--;)if(APmap[i].mun==a.id){APmap[i].setVisible(!0);break}},onDeselectAll:function(){for(i=APmap.length;i--;)APmap[i].setVisible(!1)}}}]);